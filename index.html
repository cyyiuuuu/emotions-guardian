<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æƒ…ç·’å®ˆè­·</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#78aed5',
                        secondary: '#e0f2fe',
                        dark: {
                            primary: '#6ca0c7',
                            secondary: '#0f172a'
                        }
                    }
                }
            },
            darkMode: 'class'
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        
        * {
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .main-icon {
            transition: transform 0.2s ease-in-out;
        }
        
        .main-icon:hover {
            transform: scale(1.05);
        }
        
        .page {
            transition: all 0.4s ease;
            opacity: 0;
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: translateY(20px);
        }
        
        .page.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0);
            position: relative;
        }
        
        .heart-animation {
            animation: pulse 1.5s ease infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .dark .emoji-btn {
            background-color: #1e293b;
            color: white;
        }
        
        .dark #map {
            filter: invert(90%) hue-rotate(180deg);
        }
        
        .back-btn {
            transition: all 0.2s ease;
        }
        
        .back-btn:hover {
            transform: translateX(-3px);
        }
        
        /* å‘¼å¸åœˆå‹•ç•« */
        .breath-circle {
            transition: transform 0.4s ease-in-out;
        }
        
        .breath-animation-inhale {
            animation: inhale 4s ease-in-out;
        }
        
        .breath-animation-hold {
            animation: hold 4s ease-in-out;
        }
        
        .breath-animation-exhale {
            animation: exhale 6s ease-in-out;
        }
        
        @keyframes inhale {
            from { transform: scale(1); }
            to { transform: scale(1.5); }
        }
        
        @keyframes hold {
            from { transform: scale(1.5); }
            to { transform: scale(1.5); }
        }
        
        @keyframes exhale {
            from { transform: scale(1.5); }
            to { transform: scale(1); }
        }
        
        /* éŸ³æ¨‚æ’­æ”¾æ§åˆ¶æ¨£å¼ */
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e2e8f0;
            cursor: pointer;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: #78aed5;
            width: 0%;
            transition: width 0.1s;
        }
        
        .audio-control-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .audio-control-btn:hover {
            transform: scale(1.1);
        }
        
        /* é¡è‰²é…å°éŠæˆ²æ¨£å¼ */
        .color-tile {
            width: 100%;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .color-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .target-color {
            width: 80px;
            height: 80px;
            border-radius: 0.5rem;
            margin: 0 auto;
            border: 2px solid #e2e8f0;
        }
        
        /* é»æ“Šæ³¢ç´‹æ•ˆæœ */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }
        
        @keyframes ripple {
            to {
                transform: scale(2);
                opacity: 0;
            }
        }
        
        /* å½¢ç‹€åŒ¹é…éŠæˆ²æ¨£å¼ */
        .shape-card {
            width: 100%;
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            perspective: 1000px;
            transform-style: preserve-3d;
        }

        .shape-card:hover {
            transform: scale(1.05);
        }
        
        .shape-container {
            width: 80%;
            height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* éŸ³é‡èª¿ç¯€æ»‘å¡Šæ¨£å¼ */
        input[type=range].volume-slider {
            height: 25px;
            -webkit-appearance: none;
            margin: 10px 0;
            width: 100%;
            background: transparent;
        }
        
        input[type=range].volume-slider:focus {
            outline: none;
        }
        
        input[type=range].volume-slider::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            animate: 0.2s;
            box-shadow: 0px 0px 0px #000000;
            background: #e2e8f0;
            border-radius: 3px;
            border: 0px solid #000000;
        }
        
        .dark input[type=range].volume-slider::-webkit-slider-runnable-track {
            background: #384152;
        }
        
        input[type=range].volume-slider::-webkit-slider-thumb {
            box-shadow: 0px 0px 0px #000000;
            border: 2px solid #78aed5;
            height: 18px;
            width: 18px;
            border-radius: 25px;
            background: #FFFFFF;
            cursor: pointer;
            -webkit-appearance: none;
            margin-top: -6px;
        }
        
        .dark input[type=range].volume-slider::-webkit-slider-thumb {
            background: #78aed5;
            border-color: white;
        }
        
        .music-type {
            transition: all 0.2s ease;
        }
        
        .music-type.active {
            background-color: #78aed5;
            color: white;
        }
        
        .music-type.active:hover {
            background-color: #6ca0c7;
        }
        
        .dark .music-type.active {
            background-color: #6ca0c7;
        }
        
        .dark .music-type.active:hover {
            background-color: #5d91b8;
        }
        
        /* æ–‡ä»¶ä¸Šå‚³æ¨£å¼ */
        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }
        
        .file-upload input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            cursor: pointer;
            display: block;
        }
        
        /* é¤å»³åœ°åœ–æ¨™è¨˜æ¨£å¼ */
        .map-marker {
            width: 30px;
            height: 30px;
            background-color: #78aed5;
            border-radius: 50% 50% 50% 0;
            position: absolute;
            transform: rotate(-45deg);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .map-marker:hover {
            transform: rotate(-45deg) scale(1.2);
        }
        
        .map-marker::after {
            content: '';
            width: 14px;
            height: 14px;
            margin: 8px 0 0 8px;
            background-color: white;
            position: absolute;
            border-radius: 50%;
        }
        
        .restaurant-card {
            transition: all 0.3s ease;
        }
        
        .restaurant-card:hover {
            transform: translateY(-5px);
        }
        
        /* ä¸Šä¼ å’Œç§»é™¤æŒ‰é’® */
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .uploaded-file {
            display: flex;
            align-items: center;
            background-color: #f3f4f6;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        .dark .uploaded-file {
            background-color: #374151;
        }
        
        .playlist-item {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .playlist-item:hover {
            background-color: #e5e7eb;
        }
        
        .dark .playlist-item:hover {
            background-color: #4b5563;
        }
        
        .playlist-item.active {
            background-color: #dbeafe;
        }
        
        .dark .playlist-item.active {
            background-color: #1e3a8a;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl min-h-screen relative">
        <!-- ä¸»é é¢ -->
        <div id="mainPage" class="page active">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-primary dark:text-dark-primary">æƒ…ç·’å®ˆè­·</h1>
                <p class="text-gray-600 dark:text-gray-300 mt-2">æä¾›æƒ…ç·’ç®¡ç†èˆ‡ç”Ÿæ´»è¼”åŠ©åŠŸèƒ½</p>
            </header>
            
            <div class="grid grid-cols-2 gap-6 mb-6">
                <!-- éŸ³æ¨‚åŠŸèƒ½ - å·¦ä¸Šè§’ -->
                <div>
                    <button id="musicBtn" class="main-icon bg-primary dark:bg-dark-primary hover:bg-blue-400 dark:hover:bg-blue-500 text-white w-full aspect-square rounded-2xl shadow-lg flex flex-col items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                        </svg>
                        <span class="text-lg font-bold">å˜ˆéŸ³æ¶ˆé™¤</span>
                    </button>
                </div>
                
                <!-- æƒ…ç·’ç›£æ¸¬ - å³ä¸Šè§’ -->
                <div>
                    <button id="emotionBtn" class="main-icon bg-primary dark:bg-dark-primary hover:bg-blue-400 dark:hover:bg-blue-500 text-white w-full aspect-square rounded-2xl shadow-lg flex flex-col items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-2 heart-animation" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                        <span class="text-lg font-bold">æƒ…ç·’æª¢æ¸¬</span>
                    </button>
                </div>
                
                <!-- é¤å»³æ¨è–¦ - å·¦ä¸­ -->
                <div>
                    <button id="restaurantBtn" class="main-icon bg-primary dark:bg-dark-primary hover:bg-blue-400 dark:hover:bg-blue-500 text-white w-full aspect-square rounded-2xl shadow-lg flex flex-col items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        <span class="text-lg font-bold">å‹å–„é¤å»³</span>
                    </button>
                </div>
                
                <!-- è¿·ä½ éŠæˆ² - å³ä¸­ -->
                <div>
                    <button id="gamesBtn" class="main-icon bg-primary dark:bg-dark-primary hover:bg-blue-400 dark:hover:bg-blue-500 text-white w-full aspect-square rounded-2xl shadow-lg flex flex-col items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span class="text-lg font-bold">è¿·ä½ éŠæˆ²</span>
                    </button>
                </div>
                
                <!-- è¨­ç½® - ä¸‹æ–¹ -->
                <div class="col-span-2">
                    <button id="settingsBtn" class="main-icon bg-primary dark:bg-dark-primary hover:bg-blue-400 dark:hover:bg-blue-500 text-white w-full py-4 rounded-2xl shadow-lg flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span class="text-xl font-bold">è¨­ç½®</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- éŸ³æ¨‚é é¢ -->
        <div id="musicPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="musicBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">å˜ˆéŸ³æ¶ˆé™¤</h2>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">é€£æ¥è€³æ©Ÿ</h3>
                    <button id="connectHeadphones" class="bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition w-full sm:w-auto">
                        é€£æ¥è—ç‰™è€³æ©Ÿ
                    </button>
                    <p id="headphoneStatus" class="mt-2 text-gray-500 dark:text-gray-400">æœªé€£æ¥</p>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-2">ä¸Šå‚³æ‚¨çš„éŸ³æ¨‚</h3>
                    <p class="text-gray-600 dark:text-gray-400 text-sm mb-4">ä¸Šå‚³æ‚¨å–œæ­¡çš„éŸ³æ¨‚ï¼Œåœ¨æƒ…ç·’ä¸ç©©å®šæ™‚è‡ªå‹•æ’­æ”¾</p>
                    
                    <div class="upload-btn-wrapper mb-4">
                        <button class="bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition w-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            é¸æ“‡éŸ³æ¨‚æª”æ¡ˆ (.mp3)
                        </button>
                        <input type="file" id="musicUpload" accept="audio/mp3" multiple />
                    </div>
                    
                    <div id="uploadedFiles" class="mb-4">
                        <!-- ä¸Šå‚³çš„æª”æ¡ˆæœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
                    </div>
                    
                    <div id="userPlaylist" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mb-4">
                        <h4 class="font-medium mb-2">æˆ‘çš„éŸ³æ¨‚</h4>
                        <div id="userPlaylistItems" class="max-h-40 overflow-y-auto">
                            <p class="text-gray-500 dark:text-gray-400 text-sm text-center py-2">å°šæœªä¸Šå‚³éŸ³æ¨‚</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">é¸æ“‡éŸ³æ¨‚é¡å‹</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button data-sound="https://pfst.cf2.poecdn.net/base/audio/30816ad23d2cb85a2a1a58bd63bc78118444d0c9c45289630d8235418286b7bd" class="music-type bg-secondary dark:bg-blue-900 py-4 px-4 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition">è¼•é¬†éŸ³æ¨‚</button>
                        <button data-sound="https://pfst.cf2.poecdn.net/base/audio/24916ca12e20fbfb99f4c9cfc189dbdadd8e60489d9070c3d73c65de9f8db3fa" class="music-type bg-secondary dark:bg-blue-900 py-4 px-4 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition">è‡ªç„¶è²éŸ³</button>
                        <button data-sound="https://pfst.cf2.poecdn.net/base/audio/85d66c040d1f9cefd01eb1883670b611ca6b632582eb386e1085fd01630fee43" class="music-type bg-secondary dark:bg-blue-900 py-4 px-4 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition">ç™½å™ªéŸ³</button>
                        <button data-sound="https://pfst.cf2.poecdn.net/base/audio/14e77731250f352c18ce908ead88e75341a92767a874dd748f3f228dd621297e" class="music-type bg-secondary dark:bg-blue-900 py-4 px-4 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-800 transition">ç²‰ç´…å™ªéŸ³</button>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">éŸ³é‡</h3>
                    <input type="range" min="0" max="100" value="80" class="volume-slider w-full accent-primary" id="volumeControl">
                    <div class="flex justify-between text-sm text-gray-500 dark:text-gray-400 mt-1">
                        <span>0</span>
                        <span>50</span>
                        <span>100</span>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">ç•¶å‰æ’­æ”¾</h3>
                    <div class="bg-secondary dark:bg-blue-900 rounded-lg p-6">
                        <div class="flex items-center mb-4">
                            <div class="mr-5">
                                <div id="audioVisualizer" class="w-16 h-16 bg-primary rounded-full flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                                    </svg>
                                </div>
                            </div>
                            <div class="flex-1">
                                <p id="nowPlayingTitle" class="font-semibold text-lg">æœªé¸æ“‡éŸ³æ¨‚</p>
                                <p id="nowPlayingTime" class="text-gray-600 dark:text-gray-300">0:00 / 0:00</p>
                            </div>
                        </div>
                        
                        <!-- é€²åº¦æ¢ -->
                        <div class="mb-4">
                            <div id="progressBar" class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                        </div>
                        
                        <!-- æ§åˆ¶æŒ‰éˆ• -->
                        <div class="flex items-center justify-center space-x-5">
                            <button id="prevButton" class="audio-control-btn bg-blue-100 dark:bg-blue-800 text-primary dark:text-blue-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <button id="playPauseButton" class="audio-control-btn bg-primary dark:bg-dark-primary text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" id="playIcon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <svg xmlns="http://www.w3.org/2000/svg" id="pauseIcon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </button>
                            <button id="nextButton" class="audio-control-btn bg-blue-100 dark:bg-blue-800 text-primary dark:text-blue-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                        
                        <!-- å¾ªç’°å’Œéš¨æ©Ÿæ’­æ”¾é¸é … -->
                        <div class="flex justify-center space-x-6 mt-4">
                            <button id="loopButton" class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                            <button id="shuffleButton" class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-blue-100 dark:hover:bg-blue-800">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- éŸ³æ•ˆèª¿ç¯€ -->
                <div class="mt-8">
                    <h3 class="text-lg font-semibold mb-4">éŸ³æ•ˆèª¿ç¯€</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">éŸ³èª¿</label>
                            <input type="range" min="-12" max="12" value="0" class="volume-slider w-full accent-primary" id="pitchControl">
                            <div class="flex justify-between text-sm text-gray-500 dark:text-gray-400 mt-1">
                                <span>ä½</span>
                                <span>æ­£å¸¸</span>
                                <span>é«˜</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">é€Ÿåº¦</label>
                            <input type="range" min="0.5" max="2" step="0.1" value="1" class="volume-slider w-full accent-primary" id="speedControl">
                            <div class="flex justify-between text-sm text-gray-500 dark:text-gray-400 mt-1">
                                <span>æ…¢</span>
                                <span>æ­£å¸¸</span>
                                <span>å¿«</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- éš±è—çš„éŸ³é »å…ƒç´  -->
                <audio id="audioPlayer" preload="auto"></audio>
            </div>
        </div>
        
        <!-- æƒ…ç·’æª¢æ¸¬é é¢ -->
        <div id="emotionPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="emotionBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">æƒ…ç·’æª¢æ¸¬</h2>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">æ™ºèƒ½æ‰‹éŒ¶é€£æ¥</h3>
                    <button id="connectWatch" class="bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition w-full sm:w-auto">
                        é€£æ¥æ™ºèƒ½æ‰‹éŒ¶
                    </button>
                    <p id="watchStatus" class="mt-2 text-gray-500 dark:text-gray-400">æœªé€£æ¥</p>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">ç›®å‰å¿ƒè·³</h3>
                    <div class="bg-secondary dark:bg-blue-900 rounded-lg p-8 text-center">
                        <div class="inline-block heart-animation">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-red-500 mx-auto" fill="currentColor" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                            </svg>
                        </div>
                        <p class="text-4xl font-bold mt-4" id="heartRate">75</p>
                        <p class="text-gray-600 dark:text-gray-300 text-lg">æ¯åˆ†é˜å¿ƒè·³</p>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">æƒ…ç·’ç‹€æ…‹</h3>
                    <div class="grid grid-cols-3 gap-4">
                        <button class="emoji-btn bg-secondary dark:bg-blue-900 py-6 px-4 rounded-lg hover:bg-blue-200 text-4xl">ğŸ˜Š</button>
                        <button class="emoji-btn bg-secondary dark:bg-blue-900 py-6 px-4 rounded-lg hover:bg-blue-200 text-4xl">ğŸ˜</button>
                        <button class="emoji-btn bg-secondary dark:bg-blue-900 py-6 px-4 rounded-lg hover:bg-blue-200 text-4xl">ğŸ˜Ÿ</button>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-lg font-semibold mb-4">è‡ªå‹•è™•ç†</h3>
                    <div class="space-y-4">
                        <div class="flex items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <input type="checkbox" id="autoPlayMusic" class="mr-3 h-5 w-5 accent-primary" checked>
                            <label for="autoPlayMusic" class="text-lg">æƒ…ç·’æ³¢å‹•æ™‚è‡ªå‹•æ’­æ”¾éŸ³æ¨‚</label>
                        </div>
                        <div class="flex items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <input type="checkbox" id="notifyStaff" class="mr-3 h-5 w-5 accent-primary">
                            <label for="notifyStaff" class="text-lg">æŒçºŒæƒ…ç·’ä¸ç©©æ™‚é€šçŸ¥è»Šç«™è·å“¡</label>
                        </div>
                        <div class="flex items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <input type="checkbox" id="contactEmergency" class="mr-3 h-5 w-5 accent-primary" checked>
                            <label for="contactEmergency" class="text-lg">æŒçºŒæƒ…ç·’ä¸ç©©æ™‚è¯çµ¡ç·Šæ€¥è¯çµ¡äºº</label>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">æƒ…ç·’ç´€éŒ„</h3>
                    <div class="bg-secondary dark:bg-blue-900 rounded-lg p-4">
                        <!-- è¦–åœ–åˆ‡æ› (æœˆ/å¹´) -->
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-semibold">æƒ…ç·’æ¦‚è§€</h4>
                            <div class="flex space-x-2">
                                <button class="emotion-view-btn bg-primary text-white px-3 py-1 rounded-lg">æœˆ</button>
                                <button class="emotion-view-btn bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-lg">å¹´</button>
                            </div>
                        </div>
                        
                        <!-- æœˆä»½/å¹´ä»½å°èˆª -->
                        <div class="flex justify-between items-center mb-4">
                            <button class="prev-period-btn p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                </svg>
                            </button>
                            <span id="currentPeriod" class="font-semibold">2023å¹´6æœˆ</span>
                            <button class="next-period-btn p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </div>
                        
                        <!-- æœˆè¦–åœ– -->
                        <div id="monthView" class="emotion-view">
                            <!-- æ˜ŸæœŸæ¨™é¡Œ -->
                            <div class="grid grid-cols-7 gap-1 mb-2 text-center text-sm">
                                <div>æ—¥</div>
                                <div>ä¸€</div>
                                <div>äºŒ</div>
                                <div>ä¸‰</div>
                                <div>å››</div>
                                <div>äº”</div>
                                <div>å…­</div>
                            </div>
                            
                            <!-- æ—¥æ›†ç¶²æ ¼ -->
                            <div id="monthGrid" class="grid grid-cols-7 gap-1">
                                <!-- ç”± JavaScript å¡«å……æ—¥æœŸ -->
                            </div>
                        </div>
                        
                        <!-- å¹´è¦–åœ– -->
                        <div id="yearView" class="emotion-view hidden">
                            <div id="yearGrid" class="grid grid-cols-3 sm:grid-cols-4 gap-2">
                                <!-- ç”± JavaScript å¡«å……æœˆä»½ -->
                            </div>
                        </div>
                        
                        <!-- æƒ…ç·’åœ–ä¾‹ -->
                        <div class="mt-4 flex flex-wrap items-center justify-center gap-3">
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-green-500 mr-1"></div>
                                <span class="text-sm">é–‹å¿ƒ</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-yellow-500 mr-1"></div>
                                <span class="text-sm">å¹³éœ</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-red-500 mr-1"></div>
                                <span class="text-sm">ç„¦æ…®</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-4 h-4 rounded-full bg-gray-300 dark:bg-gray-600 mr-1"></div>
                                <span class="text-sm">ç„¡æ•¸æ“š</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é¤å»³æ¨è–¦é é¢ -->
        <div id="restaurantPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="restaurantBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">è‡ªé–‰ç—‡å‹å–„é¤å»³</h2>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">æ‚¨çš„ä½ç½®</h3>
                    <div class="flex items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span id="currentLocation" class="text-lg">æ—ºè§’ç«™</span>
                        <button id="refreshLocation" class="ml-auto bg-primary text-white p-2 rounded-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">æœå°‹é¤å»³</h3>
                    <div class="flex mb-3">
                        <input type="text" id="searchRestaurant" class="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è¼¸å…¥é¤å»³åç¨±...">
                        <button id="searchBtn" class="bg-primary text-white py-3 px-4 rounded-lg ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- ç›£è­·äººæ¨¡å¼æ§åˆ¶ -->
                <div id="guardianControls" class="mb-6 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-3">
                        <h3 class="text-lg font-semibold">ç›£è­·äººæ¨¡å¼</h3>
                        <button id="toggleGuardianMode" class="bg-primary text-white py-1 px-3 rounded-lg text-sm">
                            é€²å…¥ç›£è­·äººæ¨¡å¼
                        </button>
                    </div>
                    <div id="guardianModePanel" class="hidden">
                        <div class="mb-4">
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">æ·»åŠ å¸¸å»é¤å»³</label>
                            <div class="flex">
                                <input type="text" id="newRestaurantName" class="flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è¼¸å…¥é¤å»³åç¨±">
                                <button id="addRestaurantBtn" class="bg-primary text-white py-2 px-4 rounded-lg ml-2">
                                    æ·»åŠ 
                                </button>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="font-medium mb-2">å·²æ·»åŠ çš„é¤å»³</h4>
                            <div id="favoriteRestaurants" class="max-h-40 overflow-y-auto space-y-2">
                                <!-- ç®¡ç†ç¾æœ‰é¤å»³ -->
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-medium mb-2">æ¨è–¦é¤å»³</h4>
                            <div id="recommendedRestaurants" class="max-h-40 overflow-y-auto space-y-2">
                                <!-- æ¨è–¦é¤å»³åˆ—è¡¨ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">é™„è¿‘é¤å»³</h3>
                    <div id="map" class="w-full h-64 bg-gray-200 rounded-lg mb-6 relative overflow-hidden">
                        <!-- ç°¡æ˜“åœ°åœ–æ¨¡æ“¬ -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="relative w-full h-full">
                                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-red-500 rounded-full flex items-center justify-center z-10">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </div>
                                <!-- é¤å»³æ¨™è¨˜å°‡ç”± JavaScript å‹•æ…‹æ·»åŠ  -->
                            </div>
                        </div>
                    </div>
                    
                    <div id="restaurantsList" class="space-y-4">
                        <!-- é¤å»³åˆ—è¡¨ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é¤å»³è©³ç´°è³‡è¨Šé é¢ -->
        <div id="restaurantDetailPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="restaurantDetailBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300" id="restaurantDetailName">é¤å»³åç¨±</h2>
                </div>
                
                <div class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-6">
                    <div class="flex items-start mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary mr-3 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <p id="restaurantDetailAddress" class="text-gray-700 dark:text-gray-300">é¤å»³åœ°å€</p>
                    </div>
                    <div class="flex items-start mb-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary mr-3 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p id="restaurantDetailHours" class="text-gray-700 dark:text-gray-300">ç‡Ÿæ¥­æ™‚é–“</p>
                    </div>
                    <div class="flex items-start">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary mr-3 mt-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                        </svg>
                        <p id="restaurantDetailPhone" class="text-gray-700 dark:text-gray-300">é›»è©±</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">å‹å–„ç‰¹é»</h3>
                    <div id="restaurantDetailFeatures" class="flex flex-wrap gap-2">
                        <!-- ç”± JavaScript å‹•æ…‹ç”Ÿæˆç‰¹é»æ¨™ç±¤ -->
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">é¤å»³ä»‹ç´¹</h3>
                    <p id="restaurantDetailDescription" class="text-gray-700 dark:text-gray-300">é¤å»³æè¿°</p>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button id="restaurantCallBtn" class="bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                        </svg>
                        æ’¥æ‰“é›»è©±
                    </button>
                    <button id="restaurantNavigateBtn" class="bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                        </svg>
                        å°èˆªå‰å¾€
                    </button>
                </div>
            </div>
        </div>
        
        <!-- è¿·ä½ éŠæˆ²é é¢ -->
        <div id="gamesPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="gamesBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">è¿·ä½ éŠæˆ²</h2>
                </div>
                
                <p class="text-gray-600 dark:text-gray-300 mb-6">ä»¥ä¸‹éŠæˆ²å¯ä»¥å¹«åŠ©è¨“ç·´å°ˆæ³¨åŠ›å’Œç·©è§£æƒ…ç·’</p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-secondary dark:bg-blue-900 rounded-2xl overflow-hidden shadow-md">
                        <div class="w-full h-40 bg-gradient-to-r from-blue-400 to-purple-400 flex items-center justify-center">
                            <div class="grid grid-cols-2 gap-2 p-4">
                                <div class="w-16 h-16 bg-red-500 rounded-lg"></div>
                                <div class="w-16 h-16 bg-yellow-500 rounded-lg"></div>
                                <div class="w-16 h-16 bg-green-500 rounded-lg"></div>
                                <div class="w-16 h-16 bg-blue-500 rounded-lg"></div>
                            </div>
                        </div>
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-primary dark:text-blue-300 mb-2">é¡è‰²é…å°éŠæˆ²</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">é»æ“Šèˆ‡ç›®æ¨™é¡è‰²ç›¸åŒçš„æ–¹å¡Šï¼Œè¨“ç·´åæ‡‰é€Ÿåº¦å’Œå°ˆæ³¨åŠ›</p>
                            <button id="startColorGame" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition">
                                é–‹å§‹éŠæˆ²
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-secondary dark:bg-blue-900 rounded-2xl overflow-hidden shadow-md">
                        <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMDAgMTUwIiBmaWxsPSJub25lIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzc4YWVkNSIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9Ijc1IiByPSI0MCIgZmlsbD0icmdiYSgyNTUsMjU1LDI1NSwwLjgpIiBzdHJva2U9IiM2Y2EwYzciIHN0cm9rZS13aWR0aD0iMyIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9Ijc1IiByPSIzMCIgZmlsbD0icmdiYSgxMjAsMTc0LDIxMywwLjUpIiBzdHJva2U9IiM2Y2EwYzciIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9Ijc1IiByPSIyMCIgZmlsbD0icmdiYSgxMjAsMTc0LDIxMywwLjcpIiBzdHJva2U9IiM2Y2EwYzciIHN0cm9rZS13aWR0aD0iMiIvPjxjaXJjbGUgY3g9IjEwMCIgY3k9Ijc1IiByPSIxMCIgZmlsbD0iIzZjYTBjNyIvPjxwYXRoIGQ9Ik02MCAzMGMwIDAgMjAgMjAgNDAgMjBzNDAtMjAgNDAtMjAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIzIi8+PHBhdGggZD0iTTYwIDEyMGMwIDAgMjAtMjAgNDAtMjBzNDAgMjAgNDAgMjAiIHN0cm9rZT0iI2ZmZiIgc3Ryb2tlLXdpZHRoPSIzIi8+PC9zdmc+" alt="å‘¼å¸ç·´ç¿’éŠæˆ²" class="w-full h-40 object-cover">
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-primary dark:text-blue-300 mb-2">å‘¼å¸ç·´ç¿’éŠæˆ²</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">è·Ÿéš¨å‹•ç•«é€²è¡Œæ·±å‘¼å¸ç·´ç¿’ï¼Œå¹«åŠ©æ”¾é¬†ä¸¦é™ä½ç„¦æ…®</p>
                            <button id="startBreathingGame" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition">
                                é–‹å§‹éŠæˆ²
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-secondary dark:bg-blue-900 rounded-2xl overflow-hidden shadow-md md:col-span-2">
                        <div class="w-full h-40 bg-gradient-to-r from-green-400 to-blue-400 flex items-center justify-center">
                            <div class="grid grid-cols-3 gap-3 p-3">
                                <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center">
                                    <svg class="w-10 h-10 text-primary" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="10" fill="currentColor"/>
                                    </svg>
                                </div>
                                <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center">
                                    <svg class="w-10 h-10 text-purple-500" viewBox="0 0 24 24">
                                        <rect x="4" y="4" width="16" height="16" fill="currentColor"/>
                                    </svg>
                                </div>
                                <div class="w-16 h-16 bg-white rounded-lg flex items-center justify-center">
                                    <svg class="w-10 h-10 text-yellow-500" viewBox="0 0 24 24">
                                        <polygon points="12,2 22,22 2,22" fill="currentColor"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="p-5">
                            <h3 class="text-xl font-bold text-primary dark:text-blue-300 mb-2">å½¢ç‹€åŒ¹é…éŠæˆ²</h3>
                            <p class="text-gray-600 dark:text-gray-300 mb-4">é»æ“Šèˆ‡ç›®æ¨™å½¢ç‹€ç›¸åŒçš„å¡ç‰‡ï¼Œè¨“ç·´è¦–è¦ºè¾¨è­˜èƒ½åŠ›</p>
                            <button id="startShapeGame" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition">
                                é–‹å§‹éŠæˆ²
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- é¡è‰²é…å°éŠæˆ²é é¢ -->
        <div id="colorGamePage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="colorGameBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">é¡è‰²é…å°éŠæˆ²</h2>
                    <div class="ml-auto flex items-center">
                        <span class="text-lg font-bold mr-2">å¾—åˆ†ï¼š</span>
                        <span id="colorGameScore" class="text-xl font-bold text-primary dark:text-blue-300">0</span>
                    </div>
                </div>
                
                <div class="mb-8 text-center">
                    <p class="text-lg mb-4">é»æ“Šèˆ‡ç›®æ¨™é¡è‰²ç›¸åŒçš„æ–¹å¡Š</p>
                    <div id="targetColorContainer" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-600 dark:text-gray-300 mb-3">ç›®æ¨™é¡è‰²ï¼š</p>
                        <div id="targetColor" class="target-color"></div>
                    </div>
                    <p id="gameStatus" class="text-lg text-green-500 mt-4 hidden">é…å°æ­£ç¢ºï¼</p>
                </div>
                
                <div id="colorGameGrid" class="grid grid-cols-3 gap-4 mb-6">
                    <!-- é¡è‰²æ–¹å¡Šå°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <div class="text-center">
                    <button id="startColorGameBtn" class="bg-primary text-white py-3 px-8 rounded-lg hover:bg-blue-400 transition text-lg">
                        é–‹å§‹éŠæˆ²
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å½¢ç‹€åŒ¹é…éŠæˆ²é é¢ -->
        <div id="shapeGamePage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="shapeGameBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">å½¢ç‹€åŒ¹é…éŠæˆ²</h2>
                    <div class="ml-auto flex items-center">
                        <span class="text-lg font-bold mr-2">å¾—åˆ†ï¼š</span>
                        <span id="shapeGameScore" class="text-xl font-bold text-primary dark:text-blue-300">0</span>
                    </div>
                </div>
                
                <div class="mb-8 text-center">
                    <p class="text-lg mb-4">é»æ“Šèˆ‡ç›®æ¨™å½¢ç‹€ç›¸åŒçš„å¡ç‰‡</p>
                    <div id="targetShapeContainer" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg">
                        <p class="text-gray-600 dark:text-gray-300 mb-3">ç›®æ¨™å½¢ç‹€ï¼š</p>
                        <div id="targetShape" class="w-20 h-20 mx-auto flex items-center justify-center">
                            <!-- ç›®æ¨™å½¢ç‹€å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                        </div>
                    </div>
                    <p id="shapeGameStatus" class="text-lg text-green-500 mt-4 hidden">åŒ¹é…æ­£ç¢ºï¼</p>
                </div>
                
                <div id="shapeGameGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mb-6">
                    <!-- å½¢ç‹€å¡ç‰‡å°‡ç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
                
                <div class="text-center">
                    <button id="startShapeGameBtn" class="bg-primary text-white py-3 px-8 rounded-lg hover:bg-blue-400 transition text-lg">
                        é–‹å§‹éŠæˆ²
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å‘¼å¸ç·´ç¿’éŠæˆ²é é¢ -->
        <div id="breathingGamePage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="breathingGameBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">å‘¼å¸ç·´ç¿’éŠæˆ²</h2>
                </div>
                
                <div class="mb-4 text-center">
                    <p id="breathingInstruction" class="text-xl font-bold text-primary dark:text-blue-300 mb-2">è·Ÿéš¨åœ“åœˆåšæ·±å‘¼å¸</p>
                    <p class="text-gray-600 dark:text-gray-300">é€™å€‹ç·´ç¿’å¯ä»¥å¹«åŠ©æ‚¨æ”¾é¬†èº«å¿ƒ</p>
                </div>
                
                <div class="flex justify-center items-center h-64 mb-8">
                    <div id="breathCircle" class="w-40 h-40 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center border-4 border-primary breath-circle">
                        <div class="w-32 h-32 bg-blue-200 dark:bg-blue-800 rounded-full flex items-center justify-center">
                            <div class="w-24 h-24 bg-blue-300 dark:bg-blue-700 rounded-full flex items-center justify-center">
                                <div class="w-16 h-16 bg-blue-400 dark:bg-blue-600 rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center">
                    <button id="startBreathingExercise" class="bg-primary text-white py-3 px-8 rounded-lg hover:bg-blue-400 transition text-lg">
                        é–‹å§‹ç·´ç¿’
                    </button>
                </div>
            </div>
        </div>
        
        <!-- è¨­ç½®é é¢ -->
        <div id="settingsPage" class="page">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
                <div class="flex items-center mb-6">
                    <button class="back-btn bg-gray-200 dark:bg-gray-700 p-2 rounded-lg mr-3" id="settingsBackBtn">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-primary dark:text-dark-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                        </svg>
                    </button>
                    <h2 class="text-2xl font-bold text-primary dark:text-blue-300">è¨­ç½®</h2>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4">å€‹äººè³‡æ–™</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">å§“å</label>
                            <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥æ‚¨çš„å§“å">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">å¹´é½¡</label>
                            <input type="number" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥æ‚¨çš„å¹´é½¡">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">æ€§åˆ¥</label>
                            <select class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base">
                                <option value="">è«‹é¸æ“‡</option>
                                <option value="male">ç”·</option>
                                <option value="female">å¥³</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">é›»è©±è™Ÿç¢¼</label>
                            <input type="tel" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥æ‚¨çš„é›»è©±è™Ÿç¢¼">
                        </div>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4">è¨­å‚™é€£æ¥</h3>
                    <div class="space-y-4">
                        <button id="connectHeadphonesSettings" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 010-7.072m12.728 0l3.536-3.536M6.343 6.343l-.707-.707a1 1 0 00-1.414 1.414l.707.707m12.728 0l.707-.707a1 1 0 011.414 1.414l-.707.707M3 16V8a9 9 0 0118 0v8" />
                            </svg>
                            é€£æ¥è—ç‰™è€³æ©Ÿ
                        </button>
                        <button id="connectWatchSettings" class="w-full bg-primary text-white py-3 px-4 rounded-lg hover:bg-blue-400 transition flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            é€£æ¥æ™ºèƒ½æ‰‹éŒ¶
                        </button>
                    </div>
                </div>
                
                <div class="mb-8">
                    <h3 class="text-xl font-semibold mb-4">ç·Šæ€¥è¯çµ¡äºº</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">è¯çµ¡äººå§“å</label>
                            <input type="text" id="emergencyContactName" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥è¯çµ¡äººå§“å">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">è¯çµ¡äººé›»è©±</label>
                            <input type="tel" id="emergencyContactPhone" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥è¯çµ¡äººé›»è©±">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300 mb-2">é—œä¿‚</label>
                            <input type="text" id="emergencyContactRelation" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white text-base" placeholder="è«‹è¼¸å…¥æ‚¨èˆ‡è¯çµ¡äººçš„é—œä¿‚">
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold mb-4">APP è¨­ç½®</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <span class="text-lg">æ·±è‰²æ¨¡å¼</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="darkModeToggle" class="sr-only peer">
                                <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <span class="text-lg">é€šçŸ¥</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer">
                                <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                            <span class="text-lg">ä½ç½®æœå‹™</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked class="sr-only peer">
                                <div class="w-14 h-7 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // æª¢æ¸¬æ·±è‰²æ¨¡å¼åå¥½
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
            document.getElementById('darkModeToggle').checked = true;
        }

        // ç›£è½æ·±è‰²æ¨¡å¼è®ŠåŒ–
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
                document.getElementById('darkModeToggle').checked = true;
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('darkModeToggle').checked = false;
            }
        });

        // æ·±è‰²æ¨¡å¼åˆ‡æ›
        document.getElementById('darkModeToggle').addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // ç²å–æ‰€æœ‰é é¢
        const pages = {
            main: document.getElementById('mainPage'),
            music: document.getElementById('musicPage'),
            emotion: document.getElementById('emotionPage'),
            restaurant: document.getElementById('restaurantPage'),
            restaurantDetail: document.getElementById('restaurantDetailPage'),
            games: document.getElementById('gamesPage'),
            colorGame: document.getElementById('colorGamePage'),
            shapeGame: document.getElementById('shapeGamePage'),
            breathingGame: document.getElementById('breathingGamePage'),
            settings: document.getElementById('settingsPage')
        };
        
        // ç²å–æ‰€æœ‰æŒ‰éˆ•
        const buttons = {
            music: document.getElementById('musicBtn'),
            emotion: document.getElementById('emotionBtn'),
            restaurant: document.getElementById('restaurantBtn'),
            games: document.getElementById('gamesBtn'),
            settings: document.getElementById('settingsBtn')
        };
        
        // ç²å–æ‰€æœ‰è¿”å›æŒ‰éˆ•
        const backButtons = {
            music: document.getElementById('musicBackBtn'),
            emotion: document.getElementById('emotionBackBtn'),
            restaurant: document.getElementById('restaurantBackBtn'),
            restaurantDetail: document.getElementById('restaurantDetailBackBtn'),
            games: document.getElementById('gamesBackBtn'),
            colorGame: document.getElementById('colorGameBackBtn'),
            shapeGame: document.getElementById('shapeGameBackBtn'),
            breathingGame: document.getElementById('breathingGameBackBtn'),
            settings: document.getElementById('settingsBackBtn')
        };
        
        // é¡¯ç¤ºç‰¹å®šé é¢ï¼Œéš±è—å…¶ä»–é é¢
        function showPage(pageName) {
            Object.keys(pages).forEach(key => {
                if (key === pageName) {
                    pages[key].classList.add('active');
                } else {
                    pages[key].classList.remove('active');
                }
            });
            
            // æ»¾å‹•åˆ°é é¢é ‚éƒ¨
            window.scrollTo(0, 0);
        }
        
        // è¨­ç½®ä¸»æŒ‰éˆ•é»æ“Šäº‹ä»¶
        Object.keys(buttons).forEach(key => {
            buttons[key].addEventListener('click', () => {
                showPage(key);
            });
        });
        
        // è¨­ç½®è¿”å›æŒ‰éˆ•é»æ“Šäº‹ä»¶
        Object.keys(backButtons).forEach(key => {
            if (key === 'colorGame' || key === 'shapeGame' || key === 'breathingGame') {
                backButtons[key].addEventListener('click', () => {
                    showPage('games');
                });
            } else if (key === 'restaurantDetail') {
                backButtons[key].addEventListener('click', () => {
                    showPage('restaurant');
                });
            } else {
                backButtons[key].addEventListener('click', () => {
                    showPage('main');
                });
            }
        });
        
        // è¨­ç½®éŠæˆ²é¸æ“‡æŒ‰éˆ•
        document.getElementById('startColorGame').addEventListener('click', () => {
            showPage('colorGame');
            createColorGame();
        });
        
        document.getElementById('startShapeGame').addEventListener('click', () => {
            showPage('shapeGame');
            initShapeGame();
        });
        
        document.getElementById('startBreathingGame').addEventListener('click', () => {
            showPage('breathingGame');
        });

        // æƒ…ç·’ç©©å®šåº¦èˆ‡æ³¢å‹•è¿½è¹¤
        let emotionalStability = 100; // 0-100, 100 è¡¨ç¤ºå®Œå…¨ç©©å®š
        let unstableTimeStart = null; // æƒ…ç·’ä¸ç©©å®šçš„é–‹å§‹æ™‚é–“
        const UNSTABLE_THRESHOLD = 70; // ä½æ–¼æ­¤é–¾å€¼è¢«è¦–ç‚ºæƒ…ç·’ä¸ç©©å®š
        const SEVERE_THRESHOLD = 40; // ä½æ–¼æ­¤é–¾å€¼è¢«è¦–ç‚ºåš´é‡æƒ…ç·’ä¸ç©©å®š
        const EMERGENCY_CONTACT_DELAY = 30000; // 30ç§’æŒçºŒä¸ç©©å®šæ™‚è¯çµ¡ç·Šæ€¥è¯çµ¡äºº
        const AUTO_PLAY_MUSIC_DELAY = 5000; // 5ç§’æŒçºŒä¸ç©©å®šæ™‚æ’­æ”¾éŸ³æ¨‚
        
        let contactedEmergency = false; // æ˜¯å¦å·²è¯çµ¡ç·Šæ€¥è¯çµ¡äºº
        let autoMusicPlayed = false; // æ˜¯å¦å·²è‡ªå‹•æ’­æ”¾éŸ³æ¨‚
        
        // æ¨¡æ“¬å¿ƒè·³æ•¸æ“š
        function simulateHeartRate() {
            const heartRateEl = document.getElementById('heartRate');
            let rate = parseInt(heartRateEl.textContent);
            
            // éš¨æ©Ÿæ³¢å‹•
            const change = Math.floor(Math.random() * 5) - 2;
            rate += change;
            
            // ä¿æŒåœ¨åˆç†ç¯„åœ
            if (rate < 70) rate = 70;
            if (rate > 80) rate = 80;
            
            heartRateEl.textContent = rate;
            
            // æƒ…ç·’æ³¢å‹•æ¨¡æ“¬ (æ¯éš”ä¸€æ®µæ™‚é–“)
            if (Math.random() < 0.05) {
                // æ¨¡æ“¬æƒ…ç·’æ³¢å‹•
                rate = Math.floor(Math.random() * 30) + 85;
                heartRateEl.textContent = rate;
                
                // é™ä½æƒ…ç·’ç©©å®šåº¦
                emotionalStability = Math.max(20, emotionalStability - Math.floor(Math.random() * 40) - 20);
                
                // æª¢æŸ¥æƒ…ç·’ä¸ç©©å®š
                checkEmotionalInstability();
            } else {
                // é€æ¼¸æ¢å¾©æƒ…ç·’ç©©å®šåº¦
                emotionalStability = Math.min(100, emotionalStability + 1);
                
                // å¦‚æœæ¢å¾©ç©©å®šï¼Œé‡ç½®ä¸ç©©å®šè¨ˆæ™‚
                if (emotionalStability > UNSTABLE_THRESHOLD) {
                    unstableTimeStart = null;
                    contactedEmergency = false;
                    autoMusicPlayed = false;
                }
            }
            
            setTimeout(simulateHeartRate, 2000);
        }
        
        // æª¢æŸ¥æƒ…ç·’ä¸ç©©å®šç‹€æ…‹ä¸¦æ¡å–è¡Œå‹•
        function checkEmotionalInstability() {
            // å¦‚æœæƒ…ç·’é™è‡³ä¸ç©©å®šé–¾å€¼ä»¥ä¸‹
            if (emotionalStability < UNSTABLE_THRESHOLD) {
                // å¦‚æœé€™æ˜¯å‰›é–‹å§‹ä¸ç©©å®šï¼Œè¨˜éŒ„æ™‚é–“
                if (unstableTimeStart === null) {
                    unstableTimeStart = Date.now();
                }
                
                const unstableDuration = Date.now() - unstableTimeStart;
                
                // è‡ªå‹•æ’­æ”¾éŸ³æ¨‚
                if (!autoMusicPlayed && document.getElementById('autoPlayMusic').checked && unstableDuration > AUTO_PLAY_MUSIC_DELAY) {
                    autoPlayMusic();
                    autoMusicPlayed = true;
                }
                
                // æƒ…ç·’åš´é‡ä¸ç©©å®šä¸”æŒçºŒè¶…éæŒ‡å®šæ™‚é–“
                if (!contactedEmergency && document.getElementById('contactEmergency').checked && 
                    emotionalStability < SEVERE_THRESHOLD && unstableDuration > EMERGENCY_CONTACT_DELAY) {
                    contactEmergencyPerson();
                    contactedEmergency = true;
                }
            }
        }
        
        // è‡ªå‹•æ’­æ”¾éŸ³æ¨‚åŠŸèƒ½
        function autoPlayMusic() {
            // é¡¯ç¤ºé€šçŸ¥
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 flex items-center';
            notification.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                æª¢æ¸¬åˆ°æƒ…ç·’æ³¢å‹•ï¼Œæ­£åœ¨æ’­æ”¾èˆ’ç·©éŸ³æ¨‚
            `;
            document.body.appendChild(notification);
            
            // 3ç§’å¾Œç§»é™¤é€šçŸ¥
            setTimeout(() => {
                notification.classList.add('opacity-0');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
            
            // è‡ªå‹•è·³è½‰åˆ°éŸ³æ¨‚é é¢
            setTimeout(() => {
                showPage('music');
                
                // æ’­æ”¾ç”¨æˆ¶ä¸Šå‚³çš„éŸ³æ¨‚ï¼ˆå¦‚æœæœ‰ï¼‰æˆ–è€…é»˜èªéŸ³æ¨‚
                if (userUploadedFiles.length > 0) {
                    playUserMusic(0);
                } else {
                    // æ’­æ”¾é»˜èªéŸ³æ¨‚
                    loadAudio(audioFiles[0].url, audioFiles[0].name);
                }
            }, 1500);
        }
        
        // è¯çµ¡ç·Šæ€¥è¯çµ¡äººåŠŸèƒ½
        function contactEmergencyPerson() {
            // ç²å–ç·Šæ€¥è¯çµ¡äººä¿¡æ¯
            const contactName = document.getElementById('emergencyContactName').value || "ç·Šæ€¥è¯çµ¡äºº";
            const contactPhone = document.getElementById('emergencyContactPhone').value || "æœªè¨­ç½®";
            
            // é¡¯ç¤ºè¯çµ¡é€šçŸ¥
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-red-500 text-white p-4 rounded-lg shadow-lg z-50 flex items-center';
            notification.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414" />
                </svg>
                æ­£åœ¨è¯çµ¡${contactName}(${contactPhone})...
            `;
            document.body.appendChild(notification);
            
            // 5ç§’å¾Œç§»é™¤é€šçŸ¥
            setTimeout(() => {
                notification.classList.add('opacity-0');
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }
        
        // å•Ÿå‹•å¿ƒè·³æ¨¡æ“¬
        simulateHeartRate();
        
        // é€£æ¥è¨­å‚™çš„æ¨¡æ“¬åŠŸèƒ½
        document.getElementById('connectHeadphones').addEventListener('click', function() {
            const statusEl = document.getElementById('headphoneStatus');
            statusEl.textContent = 'é€£æ¥ä¸­...';
            
            setTimeout(() => {
                statusEl.textContent = 'å·²é€£æ¥ - Noise Cancelling Headphones';
                this.textContent = 'æ–·é–‹é€£æ¥';
            }, 1500);
        });
        
        document.getElementById('connectWatch').addEventListener('click', function() {
            const statusEl = document.getElementById('watchStatus');
            statusEl.textContent = 'é€£æ¥ä¸­...';
            
            setTimeout(() => {
                statusEl.textContent = 'å·²é€£æ¥ - Smart Watch XYZ';
                this.textContent = 'æ–·é–‹é€£æ¥';
            }, 1500);
        });
        
        // è¨­ç½®é é¢ä¸­çš„é€£æ¥æŒ‰éˆ•ä¹Ÿé€²è¡Œç›¸åŒæ“ä½œ
        document.getElementById('connectHeadphonesSettings').addEventListener('click', function() {
            document.getElementById('connectHeadphones').click();
            
            const statusEl = document.getElementById('headphoneStatus');
            if (statusEl.textContent === 'æœªé€£æ¥') {
                this.textContent = 'é€£æ¥è—ç‰™è€³æ©Ÿ';
            } else {
                this.textContent = 'æ–·é–‹è—ç‰™è€³æ©Ÿ';
            }
        });
        
        document.getElementById('connectWatchSettings').addEventListener('click', function() {
            document.getElementById('connectWatch').click();
            
            const statusEl = document.getElementById('watchStatus');
            if (statusEl.textContent === 'æœªé€£æ¥') {
                this.textContent = 'é€£æ¥æ™ºèƒ½æ‰‹éŒ¶';
            } else {
                this.textContent = 'æ–·é–‹æ™ºèƒ½æ‰‹éŒ¶';
            }
        });
        
        // ç”¨æˆ¶éŸ³æ¨‚ä¸Šå‚³åŠŸèƒ½
        const userUploadedFiles = [];
        
        document.getElementById('musicUpload').addEventListener('change', function(e) {
            const files = e.target.files;
            if (!files.length) return;
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // åªæ¥å— MP3 æ–‡ä»¶
                if (file.type !== 'audio/mp3' && !file.name.endsWith('.mp3')) {
                    alert(`${file.name} ä¸æ˜¯æœ‰æ•ˆçš„ MP3 æ–‡ä»¶ã€‚`);
                    continue;
                }
                
                // å‰µå»ºæ–‡ä»¶ URL
                const fileUrl = URL.createObjectURL(file);
                
                // ä¿å­˜æ–‡ä»¶ä¿¡æ¯
                userUploadedFiles.push({
                    name: file.name,
                    url: fileUrl,
                    isUserFile: true
                });
                
                // æ›´æ–°å·²ä¸Šå‚³æ–‡ä»¶é¡¯ç¤º
                updateUploadedFilesList();
                
                // æ›´æ–°æ’­æ”¾åˆ—è¡¨
                updateUserPlaylist();
            }
            
            // æ¸…é™¤æ–‡ä»¶é¸æ“‡ï¼Œå…è¨±å†æ¬¡é¸æ“‡ç›¸åŒæ–‡ä»¶
            this.value = '';
        });
        
        // æ›´æ–°å·²ä¸Šå‚³æ–‡ä»¶åˆ—è¡¨
        function updateUploadedFilesList() {
            const container = document.getElementById('uploadedFiles');
            container.innerHTML = '';
            
            if (userUploadedFiles.length === 0) {
                return;
            }
            
            userUploadedFiles.forEach((file, index) => {
                const fileEl = document.createElement('div');
                fileEl.className = 'uploaded-file';
                fileEl.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                    </svg>
                    <span class="flex-1 truncate">${file.name}</span>
                    <button class="text-red-500 hover:text-red-700 p-1" data-index="${index}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                
                container.appendChild(fileEl);
                
                // æ·»åŠ åˆªé™¤æŒ‰éˆ•äº‹ä»¶
                const deleteBtn = fileEl.querySelector('button');
                deleteBtn.addEventListener('click', function() {
                    const fileIndex = parseInt(this.dataset.index);
                    // é‡‹æ”¾æ–‡ä»¶ URL å°è±¡
                    URL.revokeObjectURL(userUploadedFiles[fileIndex].url);
                    // å¾åˆ—è¡¨ä¸­ç§»é™¤
                    userUploadedFiles.splice(fileIndex, 1);
                    // æ›´æ–°é¡¯ç¤º
                    updateUploadedFilesList();
                    updateUserPlaylist();
                });
            });
        }
        
        // æ›´æ–°ç”¨æˆ¶æ’­æ”¾åˆ—è¡¨
        function updateUserPlaylist() {
            const container = document.getElementById('userPlaylistItems');
            container.innerHTML = '';
            
            if (userUploadedFiles.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm text-center py-2">å°šæœªä¸Šå‚³éŸ³æ¨‚</p>';
                return;
            }
            
            userUploadedFiles.forEach((file, index) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'playlist-item';
                itemEl.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                    </svg>
                    <span class="flex-1 truncate">${file.name}</span>
                    <button class="text-primary p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        </svg>
                    </button>
                `;
                
                container.appendChild(itemEl);
                
                // æ·»åŠ æ’­æ”¾æŒ‰éˆ•äº‹ä»¶
                itemEl.addEventListener('click', function() {
                    playUserMusic(index);
                });
            });
        }
        
        // æ’­æ”¾ç”¨æˆ¶éŸ³æ¨‚
        function playUserMusic(index) {
            if (index >= 0 && index < userUploadedFiles.length) {
                const file = userUploadedFiles[index];
                loadAudio(file.url, file.name);
            }
        }
        
        // éŸ³è¨Šè™•ç†ç›¸é—œåŠŸèƒ½
        const audioPlayer = document.getElementById('audioPlayer');
        const volumeControl = document.getElementById('volumeControl');
        const pitchControl = document.getElementById('pitchControl');
        const speedControl = document.getElementById('speedControl');
        const playPauseButton = document.getElementById('playPauseButton');
        const playIcon = document.getElementById('playIcon');
        const pauseIcon = document.getElementById('pauseIcon');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const loopButton = document.getElementById('loopButton');
        const shuffleButton = document.getElementById('shuffleButton');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const nowPlayingTitle = document.getElementById('nowPlayingTitle');
        const nowPlayingTime = document.getElementById('nowPlayingTime');
        const audioVisualizer = document.getElementById('audioVisualizer');
        
        // éŸ³é »æ–‡ä»¶åˆ—è¡¨
        const audioFiles = [
            { name: "è¼•é¬†éŸ³æ¨‚", url: "https://pfst.cf2.poecdn.net/base/audio/30816ad23d2cb85a2a1a58bd63bc78118444d0c9c45289630d8235418286b7bd" },
            { name: "è‡ªç„¶è²éŸ³", url: "https://pfst.cf2.poecdn.net/base/audio/24916ca12e20fbfb99f4c9cfc189dbdadd8e60489d9070c3d73c65de9f8db3fa" },
            { name: "ç™½å™ªéŸ³", url: "https://pfst.cf2.poecdn.net/base/audio/85d66c040d1f9cefd01eb1883670b611ca6b632582eb386e1085fd01630fee43" },
            { name: "ç²‰ç´…å™ªéŸ³", url: "https://pfst.cf2.poecdn.net/base/audio/14e77731250f352c18ce908ead88e75341a92767a874dd748f3f228dd621297e" }
        ];
        
        let currentAudioIndex = 0;
        let isPlaying = false;
        let isLooping = false;
        let isShuffle = false;
        let audioContext = null;
        let sourceNode = null;
        let gainNode = null;
        let isUserMusic = false; // æ˜¯å¦æ­£åœ¨æ’­æ”¾ç”¨æˆ¶ä¸Šå‚³çš„éŸ³æ¨‚
        
        // åˆå§‹åŒ–éŸ³é »æ’­æ”¾å™¨
        function initAudioPlayer() {
            // è¨­ç½®é»˜èªéŸ³é‡
            audioPlayer.volume = volumeControl.value / 100;
            
            // éŸ³é »æ’­æ”¾æ§åˆ¶
            playPauseButton.addEventListener('click', togglePlayPause);
            
            // é€²åº¦æ¢é»æ“Šäº‹ä»¶
            progressBar.addEventListener('click', function(e) {
                if (audioPlayer.src) {
                    const percent = e.offsetX / this.offsetWidth;
                    audioPlayer.currentTime = percent * audioPlayer.duration;
                    progressFill.style.width = `${percent * 100}%`;
                }
            });
            
            // éŸ³é‡æ§åˆ¶
            volumeControl.addEventListener('input', function() {
                audioPlayer.volume = this.value / 100;
            });
            
            // éŸ³é »äº‹ä»¶ç›£è½
            audioPlayer.addEventListener('timeupdate', updateProgress);
            audioPlayer.addEventListener('ended', handleAudioEnd);
            
            // æª¢æŸ¥éŸ³é »ä¸Šä¸‹æ–‡æ˜¯å¦å¯ç”¨
            try {
                window.AudioContext = window.AudioContext || window.webkitAudioContext;
            } catch (e) {
                console.log('Web Audio API ä¸æ”¯æ´');
            }
            
            // å‰ä¸€é¦–èˆ‡ä¸‹ä¸€é¦–æŒ‰éˆ•
            prevButton.addEventListener('click', playPrevious);
            nextButton.addEventListener('click', playNext);
            
            // å¾ªç’°å’Œéš¨æ©Ÿæ’­æ”¾æŒ‰éˆ•
            loopButton.addEventListener('click', toggleLoop);
            shuffleButton.addEventListener('click', toggleShuffle);
            
            // æ·»åŠ éŸ³æ•ˆèª¿ç¯€åŠŸèƒ½
            pitchControl.addEventListener('input', applyAudioEffects);
            speedControl.addEventListener('input', function() {
                audioPlayer.playbackRate = parseFloat(this.value);
            });
        }
        
        // åˆ‡æ›æ’­æ”¾/æš«åœç‹€æ…‹
        function togglePlayPause() {
            if (!audioPlayer.src) {
                // å¦‚æœæ²’æœ‰é¸æ“‡éŸ³é »ï¼Œé»˜èªæ’­æ”¾ç¬¬ä¸€å€‹
                loadAudio(audioFiles[0].url, audioFiles[0].name);
            }
            
            if (isPlaying) {
                audioPlayer.pause();
                playIcon.classList.remove('hidden');
                pauseIcon.classList.add('hidden');
                isPlaying = false;
                audioVisualizer.classList.remove('animate-pulse');
            } else {
                audioPlayer.play();
                playIcon.classList.add('hidden');
                pauseIcon.classList.remove('hidden');
                isPlaying = true;
                audioVisualizer.classList.add('animate-pulse');
            }
        }
        
        // æ›´æ–°é€²åº¦æ¢
        function updateProgress() {
            const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            progressFill.style.width = `${percent}%`;
            
            // æ›´æ–°æ™‚é–“é¡¯ç¤º
            const currentMinutes = Math.floor(audioPlayer.currentTime / 60);
            const currentSeconds = Math.floor(audioPlayer.currentTime % 60);
            const durationMinutes = Math.floor(audioPlayer.duration / 60) || 0;
            const durationSeconds = Math.floor(audioPlayer.duration % 60) || 0;
            
            nowPlayingTime.textContent = `${currentMinutes}:${currentSeconds.toString().padStart(2, '0')} / ${durationMinutes}:${durationSeconds.toString().padStart(2, '0')}`;
        }
        
        // è™•ç†éŸ³é »çµæŸäº‹ä»¶
        function handleAudioEnd() {
            if (isLooping) {
                // å¾ªç’°æ’­æ”¾ç•¶å‰æ­Œæ›²
                audioPlayer.currentTime = 0;
                audioPlayer.play();
            } else if (isShuffle) {
                // éš¨æ©Ÿæ’­æ”¾
                if (isUserMusic && userUploadedFiles.length > 0) {
                    // å¾ç”¨æˆ¶ä¸Šå‚³çš„éŸ³æ¨‚ä¸­éš¨æ©Ÿæ’­æ”¾
                    const randomIndex = Math.floor(Math.random() * userUploadedFiles.length);
                    playUserMusic(randomIndex);
                } else if (!isUserMusic && audioFiles.length > 0) {
                    // å¾é è¨­éŸ³æ¨‚ä¸­éš¨æ©Ÿæ’­æ”¾
                    let randomIndex;
                    do {
                        randomIndex = Math.floor(Math.random() * audioFiles.length);
                    } while (randomIndex === currentAudioIndex && audioFiles.length > 1);
                    
                    currentAudioIndex = randomIndex;
                    loadAudio(audioFiles[currentAudioIndex].url, audioFiles[currentAudioIndex].name);
                }
            } else {
                // æ’­æ”¾ä¸‹ä¸€é¦–
                playNext();
            }
        }
        
        // æ’­æ”¾å‰ä¸€é¦–
        function playPrevious() {
            if (isUserMusic && userUploadedFiles.length > 0) {
                // ç”¨æˆ¶éŸ³æ¨‚
                const currentIndex = userUploadedFiles.findIndex(file => file.url === audioPlayer.src);
                const prevIndex = (currentIndex > 0) ? currentIndex - 1 : userUploadedFiles.length - 1;
                playUserMusic(prevIndex);
            } else {
                // é è¨­éŸ³æ¨‚
                currentAudioIndex = (currentAudioIndex - 1 + audioFiles.length) % audioFiles.length;
                loadAudio(audioFiles[currentAudioIndex].url, audioFiles[currentAudioIndex].name);
            }
        }
        
        // æ’­æ”¾ä¸‹ä¸€é¦–
        function playNext() {
            if (isUserMusic && userUploadedFiles.length > 0) {
                // ç”¨æˆ¶éŸ³æ¨‚
                const currentIndex = userUploadedFiles.findIndex(file => file.url === audioPlayer.src);
                const nextIndex = (currentIndex < userUploadedFiles.length - 1) ? currentIndex + 1 : 0;
                playUserMusic(nextIndex);
            } else {
                // é è¨­éŸ³æ¨‚
                currentAudioIndex = (currentAudioIndex + 1) % audioFiles.length;
                loadAudio(audioFiles[currentAudioIndex].url, audioFiles[currentAudioIndex].name);
            }
        }
        
        // åˆ‡æ›å¾ªç’°ç‹€æ…‹
        function toggleLoop() {
            isLooping = !isLooping;
            loopButton.classList.toggle('text-primary');
            loopButton.classList.toggle('dark:text-dark-primary');
        }
        
        // åˆ‡æ›éš¨æ©Ÿæ’­æ”¾ç‹€æ…‹
        function toggleShuffle() {
            isShuffle = !isShuffle;
            shuffleButton.classList.toggle('text-primary');
            shuffleButton.classList.toggle('dark:text-dark-primary');
        }
        
        // åŠ è¼‰éŸ³é »
        function loadAudio(url, title) {
            // æª¢æŸ¥æ˜¯å¦ç‚ºç”¨æˆ¶éŸ³æ¨‚
            isUserMusic = userUploadedFiles.some(file => file.url === url);
            
            audioPlayer.src = url;
            nowPlayingTitle.textContent = title;
            
            // é‡ç½®é€²åº¦æ¢
            progressFill.style.width = '0%';
            
            // è‡ªå‹•æ’­æ”¾
            audioPlayer.play()
                .then(() => {
                    isPlaying = true;
                    playIcon.classList.add('hidden');
                    pauseIcon.classList.remove('hidden');
                    audioVisualizer.classList.add('animate-pulse');
                })
                .catch(err => {
                    console.log('æ’­æ”¾å¤±æ•—:', err);
                    isPlaying = false;
                    playIcon.classList.remove('hidden');
                    pauseIcon.classList.add('hidden');
                });
        }
        
        // æ‡‰ç”¨éŸ³é »æ•ˆæœ
        function applyAudioEffects() {
            // Web Audio API ç›®å‰ä¸æ”¯æ´ç›´æ¥ä¿®æ”¹éŸ³èª¿ï¼Œé€™è£¡åªæ˜¯æ¨¡æ“¬æ•ˆæœ
            if (pitchControl.value != 0) {
                audioVisualizer.style.transform = `scale(${1 + parseInt(pitchControl.value) / 20})`;
            } else {
                audioVisualizer.style.transform = '';
            }
        }
        
        // é¸æ“‡éŸ³æ¨‚é¡å‹
        document.querySelectorAll('.music-type').forEach((btn, index) => {
            btn.addEventListener('click', function() {
                // ç§»é™¤å…¶ä»–é¸ä¸­ç‹€æ…‹
                document.querySelectorAll('.music-type').forEach(b => {
                    b.classList.remove('active', 'bg-primary', 'text-white');
                    b.classList.add('bg-secondary', 'dark:bg-blue-900');
                });
                
                // æ·»åŠ é¸ä¸­ç‹€æ…‹
                this.classList.remove('bg-secondary', 'dark:bg-blue-900');
                this.classList.add('active');
                
                // æ’­æ”¾é¸ä¸­çš„éŸ³æ¨‚
                const soundUrl = this.dataset.sound;
                const soundName = this.textContent.trim();
                
                // æ‰¾åˆ°å°æ‡‰çš„ç´¢å¼•
                const fileIndex = audioFiles.findIndex(file => file.url === soundUrl);
                if (fileIndex !== -1) {
                    currentAudioIndex = fileIndex;
                    loadAudio(soundUrl, soundName);
                }
            });
        });
        
        // é¤å»³æ•¸æ“šå’ŒåŠŸèƒ½
        const restaurants = [
            {
                id: 1,
                name: "å¯§éœå’–å•¡å±‹",
                address: "æ—ºè§’å½Œæ•¦é“610è™Ÿ",
                location: { lat: 22.3186, lng: 114.1701 },
                distance: "5åˆ†é˜",
                features: ["ä½å™ªéŸ³ç’°å¢ƒ", "å°ˆæ¥­åŸ¹è¨“å“¡å·¥"],
                description: "å¯§éœå’–å•¡å±‹æä¾›ä¸€å€‹å®‰éœèˆ’é©çš„ç’°å¢ƒï¼Œæœå‹™å“¡ç¶“éå°ˆæ¥­åŸ¹è¨“ï¼Œäº†è§£å¦‚ä½•ç‚ºè‡ªé–‰ç—‡æ‚£è€…æä¾›é©ç•¶çš„æœå‹™ã€‚",
                phone: "2345-6789",
                hours: "é€±ä¸€è‡³é€±æ—¥: 08:00 - 21:00",
                branches: ["éŠ…é‘¼ç£", "å°–æ²™å’€", "å…ƒæœ—"]
            },
            {
                id: 2,
                name: "å’Œè«§é¤å»³",
                address: "æ—ºè§’èŠ±åœ’è¡—123è™Ÿ",
                location: { lat: 22.3167, lng: 114.1735 },
                distance: "7åˆ†é˜",
                features: ["å®‰éœå€åŸŸ", "è¦–è¦ºèœå–®"],
                description: "å’Œè«§é¤å»³è¨­æœ‰ç‰¹åˆ¥çš„å®‰éœå€åŸŸï¼Œä¸¦ä¸”æä¾›è¦–è¦ºèœå–®ï¼Œæ–¹ä¾¿è‡ªé–‰ç—‡æ‚£è€…é»é¤å’Œäº«ç”¨é¤é»ã€‚",
                phone: "3456-7890",
                hours: "é€±ä¸€è‡³é€±æ—¥: 11:00 - 22:00",
                branches: ["æ²™ç”°", "å¤ªå¤"]
            },
            {
                id: 3,
                name: "å‹å–„é£ŸåŠ",
                address: "æ—ºè§’è¥¿æ´‹èœå—è¡—456è™Ÿ",
                location: { lat: 22.3178, lng: 114.1693 },
                distance: "10åˆ†é˜",
                features: ["ç„¡éšœç¤™è¨­æ–½", "ç„¡éº©è³ªé¸é …"],
                description: "å‹å–„é£ŸåŠç‰¹åˆ¥ç‚ºæœ‰ç‰¹æ®Šéœ€æ±‚çš„é¡§å®¢è¨­è¨ˆï¼Œæä¾›ç„¡éšœç¤™è¨­æ–½å’Œå¤šç¨®ç„¡éº©è³ªé£Ÿå“é¸æ“‡ã€‚",
                phone: "4567-8901",
                hours: "é€±äºŒè‡³é€±æ—¥: 10:00 - 20:00",
                branches: ["è§€å¡˜", "å°‡è»æ¾³"]
            }
        ];
        
        // ç”¨æˆ¶æ”¶è—çš„é¤å»³
        let favoriteRestaurants = [];
        
        // æ¨è–¦çš„é¤å»³
        let recommendedRestaurants = [
            {
                id: 101,
                name: "éœè¬èŒ¶é¤¨",
                address: "ä¸­ç’°çš‡åå¤§é“10è™Ÿ",
                features: ["ä½å…‰ç’°å¢ƒ", "éš”éŸ³è¨­è¨ˆ"],
                added: false
            },
            {
                id: 102,
                name: "ç‰¹è‰²ç´ é£Ÿé¤å»³",
                address: "å°–æ²™å’€å»£æ±é“88è™Ÿ",
                features: ["ç‰¹æ®Šé£²é£Ÿé¸é …", "å®‰éœç’°å¢ƒ"],
                added: false
            },
            {
                id: 103,
                name: "å®¶åº­å‹å–„é¤å»³",
                address: "éŠ…é‘¼ç£æ€¡å’Œè¡—33è™Ÿ",
                features: ["å…’ç«¥å‹å–„", "æ˜ç¢ºçš„è¦–è¦ºæŒ‡å¼•"],
                added: false
            }
        ];
        
        // åˆå§‹åŒ–é¤å»³åŠŸèƒ½
        function initRestaurantFeatures() {
            // æ¸²æŸ“é¤å»³åˆ—è¡¨
            renderRestaurantsList();
            
            // æ¸²æŸ“æ”¶è—é¤å»³
            renderFavoriteRestaurants();
            
            // æ¸²æŸ“æ¨è–¦é¤å»³
            renderRecommendedRestaurants();
            
            // æ·»åŠ ç›£è­·äººæ¨¡å¼åˆ‡æ›
            document.getElementById('toggleGuardianMode').addEventListener('click', function() {
                const panel = document.getElementById('guardianModePanel');
                if (panel.classList.contains('hidden')) {
                    panel.classList.remove('hidden');
                    this.textContent = 'é€€å‡ºç›£è­·äººæ¨¡å¼';
                } else {
                    panel.classList.add('hidden');
                    this.textContent = 'é€²å…¥ç›£è­·äººæ¨¡å¼';
                }
            });
            
            // æ·»åŠ æ–°é¤å»³
            document.getElementById('addRestaurantBtn').addEventListener('click', function() {
                const restaurantName = document.getElementById('newRestaurantName').value.trim();
                if (!restaurantName) {
                    alert('è«‹è¼¸å…¥é¤å»³åç¨±');
                    return;
                }
                
                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨
                if (favoriteRestaurants.some(r => r.name === restaurantName)) {
                    alert('æ­¤é¤å»³å·²åœ¨æ”¶è—åˆ—è¡¨ä¸­');
                    return;
                }
                
                // æ·»åŠ åˆ°æ”¶è—
                const newRestaurant = {
                    id: Date.now(),
                    name: restaurantName,
                    address: "è‡ªå®šç¾©åœ°å€",
                    branches: []
                };
                
                favoriteRestaurants.push(newRestaurant);
                renderFavoriteRestaurants();
                
                // æ¸…ç©ºè¼¸å…¥æ¡†
                document.getElementById('newRestaurantName').value = '';
                
                // ç”Ÿæˆæ¨è–¦ï¼ˆæ¨¡æ“¬ï¼‰
                generateRecommendations(newRestaurant.name);
            });
            
            // æœå°‹é¤å»³
            document.getElementById('searchBtn').addEventListener('click', function() {
                const searchTerm = document.getElementById('searchRestaurant').value.trim().toLowerCase();
                if (!searchTerm) return;
                
                const allRestaurants = [...restaurants, ...favoriteRestaurants];
                const found = allRestaurants.find(r => r.name.toLowerCase().includes(searchTerm));
                
                if (found) {
                    showRestaurantDetail(found);
                } else {
                    alert('æ‰¾ä¸åˆ°ç¬¦åˆçš„é¤å»³');
                }
            });
        }
        
        // æ¸²æŸ“é¤å»³åˆ—è¡¨
        function renderRestaurantsList() {
            const container = document.getElementById('restaurantsList');
            container.innerHTML = '';
            
            // æ¸²æŸ“æ‰€æœ‰é¤å»³
            const allRestaurants = [...restaurants, ...favoriteRestaurants.filter(fr => 
                !restaurants.some(r => r.name === fr.name)
            )];
            
            // æ ¹æ“šç•¶å‰ä½ç½®ç¯©é¸é¤å»³ï¼ˆæ¨¡æ“¬ï¼‰
            const currentLocation = document.getElementById('currentLocation').textContent;
            const filteredRestaurants = allRestaurants.filter(r => {
                // æª¢æŸ¥æ˜¯å¦æœ‰åˆ†åº—åœ¨ç•¶å‰ä½ç½®
                if (r.branches && r.branches.some(b => currentLocation.includes(b))) {
                    return true;
                }
                // æˆ–è€…é¤å»³æœ¬èº«åœ¨ç•¶å‰ä½ç½®
                return r.address.includes(currentLocation) || currentLocation.includes(r.address);
            });
            
            if (filteredRestaurants.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-4">é™„è¿‘æ²’æœ‰ç™¼ç¾å‹å–„é¤å»³</p>';
                return;
            }
            
            // æ¸²æŸ“é¤å»³å¡ç‰‡
            filteredRestaurants.forEach(restaurant => {
                const card = document.createElement('div');
                card.className = 'restaurant-card bg-secondary dark:bg-blue-900 rounded-lg p-5 shadow-md';
                card.innerHTML = `
                    <h4 class="font-semibold text-lg">${restaurant.name}</h4>
                    <p class="text-gray-600 dark:text-gray-300">${restaurant.address || 'è©³ç´°åœ°å€æœªæä¾›'} - ${restaurant.distance || 'è·é›¢æœªçŸ¥'}</p>
                    <div class="flex mt-3 flex-wrap">
                        ${(restaurant.features || []).map(feature => 
                            `<span class="bg-green-100 text-green-800 text-sm px-2 py-1 rounded dark:bg-green-900 dark:text-green-200 mr-2 mb-2">${feature}</span>`
                        ).join('')}
                    </div>
                    <button class="mt-3 bg-primary text-white py-2 px-4 rounded-lg w-full hover:bg-blue-400 transition">
                        æŸ¥çœ‹è©³æƒ…
                    </button>
                `;
                
                container.appendChild(card);
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                card.querySelector('button').addEventListener('click', () => {
                    showRestaurantDetail(restaurant);
                });
                
                // æ·»åŠ é¤å»³æ¨™è¨˜åˆ°åœ°åœ–
                if (restaurant.location) {
                    addRestaurantMarker(restaurant);
                }
            });
        }
        
        // æ·»åŠ é¤å»³æ¨™è¨˜åˆ°åœ°åœ–
        function addRestaurantMarker(restaurant) {
            if (!restaurant.location) return;
            
            const map = document.getElementById('map');
            const mapWidth = map.clientWidth;
            const mapHeight = map.clientHeight;
            
            // è¨ˆç®—æ¨¡æ“¬ä½ç½®ï¼ˆå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰ä½¿ç”¨çœŸå¯¦ç¶“ç·¯åº¦è½‰æ›ï¼‰
            const x = mapWidth * (0.3 + Math.random() * 0.4); // éš¨æ©Ÿä½ç½®
            const y = mapHeight * (0.3 + Math.random() * 0.4); // éš¨æ©Ÿä½ç½®
            
            const marker = document.createElement('div');
            marker.className = 'map-marker';
            marker.style.left = `${x}px`;
            marker.style.top = `${y}px`;
            marker.setAttribute('data-restaurant-id', restaurant.id);
            
            map.appendChild(marker);
            
            // æ·»åŠ é»æ“Šäº‹ä»¶
            marker.addEventListener('click', () => {
                showRestaurantDetail(restaurant);
            });
        }
        
        // é¡¯ç¤ºé¤å»³è©³æƒ…
        function showRestaurantDetail(restaurant) {
            // å¡«å……é¤å»³è©³æƒ…
            document.getElementById('restaurantDetailName').textContent = restaurant.name;
            document.getElementById('restaurantDetailAddress').textContent = restaurant.address || 'åœ°å€æœªæä¾›';
            document.getElementById('restaurantDetailHours').textContent = restaurant.hours || 'ç‡Ÿæ¥­æ™‚é–“æœªæä¾›';
            document.getElementById('restaurantDetailPhone').textContent = restaurant.phone || 'é›»è©±æœªæä¾›';
            
            // æ¸…ç©ºä¸¦å¡«å……ç‰¹é»æ¨™ç±¤
            const featuresContainer = document.getElementById('restaurantDetailFeatures');
            featuresContainer.innerHTML = '';
            
            if (restaurant.features && restaurant.features.length > 0) {
                restaurant.features.forEach(feature => {
                    const featureTag = document.createElement('span');
                    featureTag.className = 'bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full dark:bg-blue-900 dark:text-blue-200';
                    featureTag.textContent = feature;
                    featuresContainer.appendChild(featureTag);
                });
            } else {
                featuresContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">æ²’æœ‰ç‰¹é»è³‡è¨Š</p>';
            }
            
            // è¨­ç½®é¤å»³æè¿°
            document.getElementById('restaurantDetailDescription').textContent = restaurant.description || 'æ²’æœ‰è©³ç´°æè¿°';
            
            // è¨­ç½®æ“ä½œæŒ‰éˆ•
            const callBtn = document.getElementById('restaurantCallBtn');
            const navigateBtn = document.getElementById('restaurantNavigateBtn');
            
            callBtn.onclick = () => {
                if (restaurant.phone) {
                    alert(`æº–å‚™æ’¥æ‰“é›»è©±è‡³: ${restaurant.phone}`);
                } else {
                    alert('æ²’æœ‰æä¾›é›»è©±è™Ÿç¢¼');
                }
            };
            
            navigateBtn.onclick = () => {
                alert(`æº–å‚™å°èˆªè‡³: ${restaurant.name} (${restaurant.address})`);
            };
            
            // é¡¯ç¤ºè©³æƒ…é é¢
            showPage('restaurantDetail');
        }
        
        // æ¸²æŸ“æ”¶è—é¤å»³åˆ—è¡¨
        function renderFavoriteRestaurants() {
            const container = document.getElementById('favoriteRestaurants');
            container.innerHTML = '';
            
            if (favoriteRestaurants.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm text-center py-2">å°šæœªæ·»åŠ å¸¸å»é¤å»³</p>';
                return;
            }
            
            favoriteRestaurants.forEach((restaurant, index) => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded-lg';
                item.innerHTML = `
                    <span class="flex-1">${restaurant.name}</span>
                    <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 p-1 add-branch-btn" data-index="${index}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                    <button class="text-red-500 hover:text-red-700 p-1 remove-restaurant-btn" data-index="${index}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                
                container.appendChild(item);
                
                // æ·»åŠ åˆªé™¤æŒ‰éˆ•äº‹ä»¶
                item.querySelector('.remove-restaurant-btn').addEventListener('click', function() {
                    const restaurantIndex = parseInt(this.dataset.index);
                    favoriteRestaurants.splice(restaurantIndex, 1);
                    renderFavoriteRestaurants();
                    renderRestaurantsList();
                });
                
                // æ·»åŠ åˆ†åº—æŒ‰éˆ•äº‹ä»¶
                item.querySelector('.add-branch-btn').addEventListener('click', function() {
                    const restaurantIndex = parseInt(this.dataset.index);
                    const branch = prompt('è«‹è¼¸å…¥åˆ†åº—åœ°å€ (ä¾‹å¦‚: æ—ºè§’, éŠ…é‘¼ç£)');
                    
                    if (branch && branch.trim()) {
                        if (!favoriteRestaurants[restaurantIndex].branches) {
                            favoriteRestaurants[restaurantIndex].branches = [];
                        }
                        
                        favoriteRestaurants[restaurantIndex].branches.push(branch.trim());
                        alert(`å·²æ·»åŠ  ${favoriteRestaurants[restaurantIndex].name} çš„ ${branch.trim()} åˆ†åº—`);
                        renderRestaurantsList();
                    }
                });
                
                // é¡¯ç¤ºåˆ†åº—ï¼ˆå¦‚æœæœ‰ï¼‰
                if (restaurant.branches && restaurant.branches.length > 0) {
                    const branchesContainer = document.createElement('div');
                    branchesContainer.className = 'mt-1 ml-4 space-y-1';
                    
                    restaurant.branches.forEach(branch => {
                        const branchItem = document.createElement('div');
                        branchItem.className = 'flex items-center text-sm text-gray-500 dark:text-gray-400';
                        branchItem.innerHTML = `
                            <span class="mr-1">â€¢</span>
                            <span>${branch}</span>
                        `;
                        branchesContainer.appendChild(branchItem);
                    });
                    
                    item.insertAdjacentElement('afterend', branchesContainer);
                }
            });
        }
        
        // æ¸²æŸ“æ¨è–¦é¤å»³
        function renderRecommendedRestaurants() {
            const container = document.getElementById('recommendedRestaurants');
            container.innerHTML = '';
            
            if (recommendedRestaurants.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm text-center py-2">æ²’æœ‰æ¨è–¦é¤å»³</p>';
                return;
            }
            
            // åªé¡¯ç¤ºæœªè¢«æ·»åŠ çš„æ¨è–¦
            const filteredRecommendations = recommendedRestaurants.filter(r => !r.added);
            
            if (filteredRecommendations.length === 0) {
                container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-sm text-center py-2">æ²’æœ‰æ–°çš„æ¨è–¦é¤å»³</p>';
                return;
            }
            
            filteredRecommendations.forEach((restaurant, index) => {
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between bg-gray-50 dark:bg-gray-700 p-2 rounded-lg';
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="font-medium">${restaurant.name}</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400">${restaurant.address}</div>
                        <div class="flex mt-1 flex-wrap">
                            ${(restaurant.features || []).map(feature => 
                                `<span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-200 mr-2 mb-1">${feature}</span>`
                            ).join('')}
                        </div>
                    </div>
                    <button class="text-primary hover:text-blue-700 p-1 add-recommendation-btn" data-index="${index}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                        </svg>
                    </button>
                `;
                
                container.appendChild(item);
                
                // æ·»åŠ æŒ‰éˆ•äº‹ä»¶
                item.querySelector('.add-recommendation-btn').addEventListener('click', function() {
                    const recommendationIndex = parseInt(this.dataset.index);
                    const recommendedRestaurant = recommendedRestaurants[recommendationIndex];
                    
                    // æ¨™è¨˜ç‚ºå·²æ·»åŠ 
                    recommendedRestaurants[recommendationIndex].added = true;
                    
                    // æ·»åŠ åˆ°æ”¶è—é¤å»³
                    favoriteRestaurants.push({
                        id: recommendedRestaurant.id,
                        name: recommendedRestaurant.name,
                        address: recommendedRestaurant.address,
                        features: recommendedRestaurant.features,
                        branches: []
                    });
                    
                    // æ›´æ–°é¡¯ç¤º
                    renderFavoriteRestaurants();
                    renderRecommendedRestaurants();
                    renderRestaurantsList();
                });
            });
        }
        
        // ç”Ÿæˆé¤å»³æ¨è–¦ï¼ˆæ¨¡æ“¬ï¼‰
        function generateRecommendations(restaurantName) {
            // æ¨¡æ“¬å¾æœå‹™å™¨ç²å–æ¨è–¦
            setTimeout(() => {
                // ç”Ÿæˆä¸€å€‹æ–°çš„æ¨è–¦
                const newRecommendation = {
                    id: 100 + Math.floor(Math.random() * 900),
                    name: `${restaurantName}çš„ç›¸ä¼¼é¤å»³`,
                    address: ["éŠ…é‘¼ç£", "å°–æ²™å’€", "ä¸­ç’°", "æ—ºè§’"][Math.floor(Math.random() * 4)] + "åˆ†åº—",
                    features: ["å®‰éœç’°å¢ƒ", "ç„¡éšœç¤™è¨­æ–½", "ç‰¹æ®Šé£²é£Ÿé¸é …", "å‹å–„å“¡å·¥"][Math.floor(Math.random() * 4)].split(),
                    added: false
                };
                
                recommendedRestaurants.push(newRecommendation);
                renderRecommendedRestaurants();
            }, 1000);
        }
        
        // æ›´æ–°ä½ç½®æŒ‰éˆ•
        document.getElementById('refreshLocation').addEventListener('click', function() {
            const locations = ['æ—ºè§’ç«™', 'éŠ…é‘¼ç£ç«™', 'ä¸­ç’°ç«™', 'æ·±æ°´åŸ—ç«™', 'ä¹é¾ç£ç«™'];
            const randomLocation = locations[Math.floor(Math.random() * locations.length)];
            document.getElementById('currentLocation').textContent = randomLocation;
            
            // é‡æ–°æ¸²æŸ“é¤å»³åˆ—è¡¨
            renderRestaurantsList();
        });
        
        // é¡è‰²é…å°éŠæˆ²åŠŸèƒ½
        let colorGameActive = false;
        let colorGameScore = 0;
        
        // å¯ç”¨çš„é¡è‰²
        const gameColors = [
            { name: 'ç´…è‰²', hex: '#e74c3c' },
            { name: 'è—è‰²', hex: '#3498db' },
            { name: 'ç¶ è‰²', hex: '#2ecc71' },
            { name: 'é»ƒè‰²', hex: '#f1c40f' },
            { name: 'ç´«è‰²', hex: '#9b59b6' },
            { name: 'æ©™è‰²', hex: '#e67e22' },
            { name: 'ç²‰è‰²', hex: '#e84393' },
            { name: 'é’è‰²', hex: '#00cec9' },
            { name: 'æ£•è‰²', hex: '#d35400' }
        ];
        
        function createColorGame() {
            const grid = document.getElementById('colorGameGrid');
            grid.innerHTML = '';
            
            // éš¨æ©Ÿé¸æ“‡ç›®æ¨™é¡è‰²
            const targetIndex = Math.floor(Math.random() * gameColors.length);
            const targetColor = gameColors[targetIndex];
            
            // è¨­ç½®ç›®æ¨™é¡è‰²
            const targetColorEl = document.getElementById('targetColor');
            targetColorEl.style.backgroundColor = targetColor.hex;
            
            // éš¨æ©Ÿæ’åˆ—é¡è‰²
            const shuffledColors = [...gameColors];
            for (let i = shuffledColors.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledColors[i], shuffledColors[j]] = [shuffledColors[j], shuffledColors[i]];
            }
            
            // å‰µå»ºé¡è‰²æ–¹å¡Š
            shuffledColors.forEach(color => {
                const colorTile = document.createElement('button');
                colorTile.className = 'color-tile aspect-square';
                colorTile.style.backgroundColor = color.hex;
                
                colorTile.addEventListener('click', function(e) {
                    if (!colorGameActive) return;
                    
                    // å‰µå»ºé»æ“Šæ³¢ç´‹æ•ˆæœ
                    const ripple = document.createElement('span');
                    ripple.className = 'ripple';
                    this.appendChild(ripple);
                    
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    ripple.style.width = ripple.style.height = `${size}px`;
                    ripple.style.left = `${e.clientX - rect.left - size/2}px`;
                    ripple.style.top = `${e.clientY - rect.top - size/2}px`;
                    
                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                    
                    // æª¢æŸ¥æ˜¯å¦åŒ¹é…ç›®æ¨™é¡è‰²
                    if (color.hex === targetColor.hex) {
                        colorGameScore++;
                        document.getElementById('colorGameScore').textContent = colorGameScore;
                        
                        // é¡¯ç¤ºæ­£ç¢ºæç¤º
                        const statusEl = document.getElementById('gameStatus');
                        statusEl.textContent = 'é…å°æ­£ç¢ºï¼';
                        statusEl.classList.remove('hidden', 'text-red-500');
                        statusEl.classList.add('text-green-500');
                        statusEl.classList.remove('hidden');
                        
                        setTimeout(() => {
                            statusEl.classList.add('hidden');
                        }, 1000);
                        
                        // é‡æ–°å‰µå»ºéŠæˆ²
                        createColorGame();
                    } else {
                        // é¡¯ç¤ºéŒ¯èª¤æç¤º
                        const statusEl = document.getElementById('gameStatus');
                        statusEl.textContent = 'é…å°éŒ¯èª¤ï¼';
                        statusEl.classList.remove('hidden', 'text-green-500');
                        statusEl.classList.add('text-red-500');
                        statusEl.classList.remove('hidden');
                        
                        setTimeout(() => {
                            statusEl.classList.add('hidden');
                        }, 1000);
                    }
                });
                
                grid.appendChild(colorTile);
            });
        }
        
        function startColorGame() {
            // é‡ç½®éŠæˆ²
            colorGameScore = 0;
            document.getElementById('colorGameScore').textContent = '0';
            document.getElementById('gameStatus').classList.add('hidden');
            
            // å‰µå»ºéŠæˆ²
            createColorGame();
            
            // å•Ÿå‹•éŠæˆ²
            colorGameActive = true;
            document.getElementById('startColorGameBtn').textContent = 'é‡æ–°é–‹å§‹';
        }
        
        // è¨­ç½®é¡è‰²éŠæˆ²é–‹å§‹æŒ‰éˆ•
        document.getElementById('startColorGameBtn').addEventListener('click', startColorGame);
        
        // å½¢ç‹€åŒ¹é…éŠæˆ²åŠŸèƒ½
        let shapeGameActive = false;
        let shapeGameScore = 0;
        
        // å¯ç”¨çš„å½¢ç‹€
        const gameShapes = [
            { 
                name: 'åœ“å½¢', 
                svg: '<circle cx="50" cy="50" r="40" fill="currentColor"/>' 
            },
            { 
                name: 'æ­£æ–¹å½¢', 
                svg: '<rect x="10" y="10" width="80" height="80" fill="currentColor"/>' 
            },
            { 
                name: 'ä¸‰è§’å½¢', 
                svg: '<polygon points="50,10 90,90 10,90" fill="currentColor"/>' 
            },
            { 
                name: 'æ˜Ÿæ˜Ÿ', 
                svg: '<polygon points="50,10 61,35 90,35 65,55 75,80 50,65 25,80 35,55 10,35 39,35" fill="currentColor"/>' 
            },
            { 
                name: 'å¿ƒå½¢', 
                svg: '<path d="M50,80 C80,60 100,10 50,30 C0,10 20,60 50,80" fill="currentColor"/>' 
            },
            { 
                name: 'è±å½¢', 
                svg: '<polygon points="50,10 90,50 50,90 10,50" fill="currentColor"/>' 
            }
        ];
        
        // å½¢ç‹€çš„å¯èƒ½é¡è‰²
        const shapeColors = [
            '#e74c3c', // ç´…è‰²
            '#3498db', // è—è‰²
            '#2ecc71', // ç¶ è‰²
            '#f1c40f', // é»ƒè‰²
            '#9b59b6', // ç´«è‰²
            '#e67e22'  // æ©™è‰²
        ];
        
        function initShapeGame() {
            // æ¸…ç©ºç¶²æ ¼
            const grid = document.getElementById('shapeGameGrid');
            grid.innerHTML = '';
            
            // éš¨æ©Ÿé¸æ“‡ç›®æ¨™å½¢ç‹€
            const targetIndex = Math.floor(Math.random() * gameShapes.length);
            const targetShape = gameShapes[targetIndex];
            
            // è¨­ç½®ç›®æ¨™å½¢ç‹€
            const targetShapeEl = document.getElementById('targetShape');
            targetShapeEl.innerHTML = `
                <svg viewBox="0 0 100 100" width="100%" height="100%" class="text-primary">
                    ${targetShape.svg}
                </svg>
            `;
            
            // éš¨æ©Ÿæ’åˆ—å½¢ç‹€ï¼ˆåŒ…æ‹¬ä¸åŒé¡è‰²çš„ç›®æ¨™å½¢ç‹€å’Œå…¶ä»–å½¢ç‹€ï¼‰
            let shapeCards = [];
            
            // æ·»åŠ 3å€‹ç›®æ¨™å½¢ç‹€ï¼ˆä¸åŒé¡è‰²ï¼‰
            const targetColor = shapeColors[Math.floor(Math.random() * shapeColors.length)];
            for (let i = 0; i < 3; i++) {
                shapeCards.push({
                    shape: targetShape,
                    color: shapeColors[Math.floor(Math.random() * shapeColors.length)],
                    isTarget: true
                });
            }
            
            // æ·»åŠ å…¶ä»–å½¢ç‹€
            for (let i = 0; i < 3; i++) {
                let shape;
                do {
                    shape = gameShapes[Math.floor(Math.random() * gameShapes.length)];
                } while (shape.name === targetShape.name);
                
                shapeCards.push({
                    shape: shape,
                    color: shapeColors[Math.floor(Math.random() * shapeColors.length)],
                    isTarget: false
                });
            }
            
            // æ´—ç‰Œç®—æ³•
            for (let i = shapeCards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shapeCards[i], shapeCards[j]] = [shapeCards[j], shapeCards[i]];
            }
            
            // å‰µå»ºå½¢ç‹€å¡ç‰‡
            shapeCards.forEach(card => {
                const shapeCard = document.createElement('div');
                shapeCard.className = 'shape-card bg-white dark:bg-gray-700 shadow-md';
                shapeCard.innerHTML = `
                    <div class="shape-container">
                        <svg viewBox="0 0 100 100" width="100%" height="100%" style="color: ${card.color};">
                            ${card.shape.svg}
                        </svg>
                    </div>
                `;
                
                shapeCard.addEventListener('click', function() {
                    if (!shapeGameActive) return;
                    
                    if (card.isTarget) {
                        // æ­£ç¢ºåŒ¹é…
                        shapeGameScore++;
                        document.getElementById('shapeGameScore').textContent = shapeGameScore;
                        
                        // è¦–è¦ºåé¥‹
                        this.classList.add('bg-green-100', 'dark:bg-green-900');
                        setTimeout(() => {
                            // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                            const statusEl = document.getElementById('shapeGameStatus');
                            statusEl.textContent = 'åŒ¹é…æ­£ç¢ºï¼';
                            statusEl.classList.remove('hidden', 'text-red-500');
                            statusEl.classList.add('text-green-500');
                            statusEl.classList.remove('hidden');
                            
                            setTimeout(() => {
                                statusEl.classList.add('hidden');
                                // é‡æ–°åˆå§‹åŒ–éŠæˆ²
                                initShapeGame();
                            }, 1000);
                        }, 300);
                    } else {
                        // éŒ¯èª¤åŒ¹é…
                        this.classList.add('bg-red-100', 'dark:bg-red-900');
                        setTimeout(() => {
                            this.classList.remove('bg-red-100', 'dark:bg-red-900');
                            
                            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
                            const statusEl = document.getElementById('shapeGameStatus');
                            statusEl.textContent = 'å½¢ç‹€ä¸åŒ¹é…ï¼';
                            statusEl.classList.remove('hidden', 'text-green-500');
                            statusEl.classList.add('text-red-500');
                            statusEl.classList.remove('hidden');
                            
                            setTimeout(() => {
                                statusEl.classList.add('hidden');
                            }, 1000);
                        }, 300);
                    }
                });
                
                grid.appendChild(shapeCard);
            });
        }
        
        function startShapeGame() {
            // é‡ç½®éŠæˆ²
            shapeGameScore = 0;
            document.getElementById('shapeGameScore').textContent = '0';
            document.getElementById('shapeGameStatus').classList.add('hidden');
            
            // åˆå§‹åŒ–éŠæˆ²
            initShapeGame();
            
            // å•Ÿå‹•éŠæˆ²
            shapeGameActive = true;
            document.getElementById('startShapeGameBtn').textContent = 'é‡æ–°é–‹å§‹';
        }
        
        // è¨­ç½®å½¢ç‹€éŠæˆ²é–‹å§‹æŒ‰éˆ•
        document.getElementById('startShapeGameBtn').addEventListener('click', startShapeGame);
        
        // å‘¼å¸ç·´ç¿’éŠæˆ²åŠŸèƒ½
        let breathingInterval;
        let isBreathingActive = false;
        
        document.getElementById('startBreathingExercise').addEventListener('click', function() {
            const breathCircle = document.getElementById('breathCircle');
            const instruction = document.getElementById('breathingInstruction');
            
            if (isBreathingActive) {
                // åœæ­¢ç·´ç¿’
                clearInterval(breathingInterval);
                this.textContent = 'é–‹å§‹ç·´ç¿’';
                instruction.textContent = 'è·Ÿéš¨åœ“åœˆåšæ·±å‘¼å¸';
                breathCircle.classList.remove('breath-animation-inhale', 'breath-animation-hold', 'breath-animation-exhale');
                isBreathingActive = false;
            } else {
                // é–‹å§‹ç·´ç¿’
                this.textContent = 'åœæ­¢ç·´ç¿’';
                isBreathingActive = true;
                
                let phase = 0; // 0: å¸æ°£, 1: å±æ¯, 2: å‘¼æ°£
                
                function updateBreathing() {
                    switch(phase) {
                        case 0: // å¸æ°£
                            instruction.textContent = 'å¸æ°£...';
                            breathCircle.classList.remove('breath-animation-exhale', 'breath-animation-hold');
                            breathCircle.classList.add('breath-animation-inhale');
                            phase = 1;
                            setTimeout(updateBreathing, 4000);
                            break;
                        case 1: // å±æ¯
                            instruction.textContent = 'å±æ¯...';
                            breathCircle.classList.remove('breath-animation-inhale', 'breath-animation-exhale');
                            breathCircle.classList.add('breath-animation-hold');
                            phase = 2;
                            setTimeout(updateBreathing, 4000);
                            break;
                        case 2: // å‘¼æ°£
                            instruction.textContent = 'å‘¼æ°£...';
                            breathCircle.classList.remove('breath-animation-inhale', 'breath-animation-hold');
                            breathCircle.classList.add('breath-animation-exhale');
                            phase = 0;
                            setTimeout(updateBreathing, 6000);
                            break;
                    }
                }
                
                updateBreathing();
            }
        });
        
        // æƒ…ç·’è¿½è¹¤åŠŸèƒ½
        let viewMode = 'month'; // 'month' æˆ– 'year'
        let currentDate = new Date();
        let emotionData = {}; // å­˜å„²æƒ…ç·’æ•¸æ“š { 'YYYY-MM-DD': emotionValue }

        // åˆå§‹åŒ–æƒ…ç·’æ•¸æ“š (æ¨¡æ“¬æ•¸æ“š)
        function initEmotionData() {
            const today = new Date();
            const startDate = new Date(today);
            startDate.setMonth(today.getMonth() - 6); // å¾å…­å€‹æœˆå‰é–‹å§‹
            
            for (let d = new Date(startDate); d <= today; d.setDate(d.getDate() + 1)) {
                // éš¨æ©Ÿç”Ÿæˆæƒ…ç·’ (1: é–‹å¿ƒ, 2: å¹³éœ, 3: ç„¦æ…®)
                const emotion = Math.floor(Math.random() * 3) + 1;
                const dateStr = formatDate(d);
                emotionData[dateStr] = emotion;
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸç‚º 'YYYY-MM-DD'
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // æ›´æ–°ç•¶å‰é¡¯ç¤ºçš„æœŸé–“
        function updateCurrentPeriod() {
            const periodEl = document.getElementById('currentPeriod');
            if (viewMode === 'month') {
                periodEl.textContent = `${currentDate.getFullYear()}å¹´${currentDate.getMonth() + 1}æœˆ`;
            } else {
                periodEl.textContent = `${currentDate.getFullYear()}å¹´`;
            }
        }

        // æ ¹æ“šæƒ…ç·’å€¼ç²å–é¡è‰²
        function getEmotionColor(emotion) {
            switch(emotion) {
                case 1: return 'bg-green-500'; // é–‹å¿ƒ
                case 2: return 'bg-yellow-500'; // å¹³éœ
                case 3: return 'bg-red-500'; // ç„¦æ…®
                default: return 'bg-gray-300 dark:bg-gray-600'; // ç„¡æ•¸æ“š
            }
        }

        // æ¸²æŸ“æœˆè¦–åœ–
        function renderMonthView() {
            const monthGrid = document.getElementById('monthGrid');
            monthGrid.innerHTML = '';
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // ç²å–ç•¶æœˆç¬¬ä¸€å¤©
            const firstDay = new Date(year, month, 1);
            // ç²å–ç•¶æœˆæœ€å¾Œä¸€å¤©
            const lastDay = new Date(year, month + 1, 0);
            
            // è¨ˆç®—éœ€è¦é¡¯ç¤ºçš„å‰ä¸€å€‹æœˆçš„æ—¥æœŸæ•¸é‡
            const daysFromPrevMonth = firstDay.getDay();
            
            // å‰µå»ºå‰ä¸€å€‹æœˆçš„æ—¥æœŸå–®å…ƒæ ¼
            const prevMonth = new Date(year, month, 0);
            for (let i = prevMonth.getDate() - daysFromPrevMonth + 1; i <= prevMonth.getDate(); i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'aspect-square flex flex-col items-center justify-center text-gray-400 dark:text-gray-500 text-sm';
                dayEl.textContent = i;
                monthGrid.appendChild(dayEl);
            }
            
            // å‰µå»ºç•¶æœˆçš„æ—¥æœŸå–®å…ƒæ ¼
            for (let i = 1; i <= lastDay.getDate(); i++) {
                const dateObj = new Date(year, month, i);
                const dateStr = formatDate(dateObj);
                const emotion = emotionData[dateStr] || 0;
                
                const dayEl = document.createElement('div');
                dayEl.className = 'aspect-square p-1 flex flex-col items-center relative';
                
                const dayText = document.createElement('span');
                dayText.className = 'text-sm';
                dayText.textContent = i;
                dayEl.appendChild(dayText);
                
                const emotionIndicator = document.createElement('div');
                emotionIndicator.className = `w-5 h-5 rounded-full mt-1 ${getEmotionColor(emotion)}`;
                dayEl.appendChild(emotionIndicator);
                
                // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ·»åŠ é«˜äº®
                const today = new Date();
                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === i) {
                    dayEl.classList.add('bg-blue-100', 'dark:bg-blue-900', 'rounded-lg');
                }
                
                monthGrid.appendChild(dayEl);
            }
            
            // æ·»åŠ ä¸‹ä¸€å€‹æœˆçš„æ—¥æœŸä¾†å¡«å……ç¶²æ ¼
            const daysFromNextMonth = 42 - (daysFromPrevMonth + lastDay.getDate()); // 6è¡Œ7åˆ— = 42å€‹å–®å…ƒæ ¼
            for (let i = 1; i <= daysFromNextMonth; i++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'aspect-square flex flex-col items-center justify-center text-gray-400 dark:text-gray-500 text-sm';
                dayEl.textContent = i;
                monthGrid.appendChild(dayEl);
            }
        }

        // æ¸²æŸ“å¹´è¦–åœ–
        function renderYearView() {
            const yearGrid = document.getElementById('yearGrid');
            yearGrid.innerHTML = '';
            
            const year = currentDate.getFullYear();
            
            // ç‚ºæ¯å€‹æœˆå‰µå»ºä¸€å€‹å–®å…ƒæ ¼
            for (let month = 0; month < 12; month++) {
                const monthEl = document.createElement('div');
                monthEl.className = 'bg-gray-100 dark:bg-gray-700 rounded-lg p-2 flex flex-col items-center';
                
                // æœˆä»½åç¨±
                const monthName = document.createElement('div');
                monthName.className = 'text-sm font-semibold mb-1';
                monthName.textContent = `${month + 1}æœˆ`;
                monthEl.appendChild(monthName);
                
                // å‰µå»ºæƒ…ç·’æŒ‡ç¤ºå™¨çš„ç¶²æ ¼
                const miniGrid = document.createElement('div');
                miniGrid.className = 'grid grid-cols-7 gap-px w-full';
                
                // è¨ˆç®—ç•¶æœˆç¸½å¤©æ•¸
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // è¨ˆç®—ç•¶æœˆç¬¬ä¸€å¤©æ˜¯æ˜ŸæœŸå¹¾
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                
                // æ·»åŠ ç©ºç™½å–®å…ƒæ ¼
                for (let i = 0; i < firstDayOfMonth; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'aspect-square';
                    miniGrid.appendChild(emptyDay);
                }
                
                // æ·»åŠ æ—¥æœŸå–®å…ƒæ ¼
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateObj = new Date(year, month, day);
                    const dateStr = formatDate(dateObj);
                    const emotion = emotionData[dateStr] || 0;
                    
                    const dayEl = document.createElement('div');
                    dayEl.className = `aspect-square ${getEmotionColor(emotion)} rounded-full`;
                    
                    // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ·»åŠ é‚Šæ¡†
                    const today = new Date();
                    if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                        dayEl.classList.add('border-2', 'border-primary', 'dark:border-dark-primary');
                    }
                    
                    miniGrid.appendChild(dayEl);
                }
                
                monthEl.appendChild(miniGrid);
                yearGrid.appendChild(monthEl);
            }
        }

        // åˆ‡æ›æœˆ/å¹´è¦–åœ–
        function toggleView(newMode) {
            viewMode = newMode;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.emotion-view-btn').forEach((btn, index) => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-gray-200', 'dark:bg-gray-700');
                
                if ((index === 0 && newMode === 'month') || (index === 1 && newMode === 'year')) {
                    btn.classList.add('bg-primary', 'text-white');
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                }
            });
            
            // é¡¯ç¤ºç›¸æ‡‰è¦–åœ–
            if (newMode === 'month') {
                document.getElementById('monthView').classList.remove('hidden');
                document.getElementById('yearView').classList.add('hidden');
            } else {
                document.getElementById('monthView').classList.add('hidden');
                document.getElementById('yearView').classList.remove('hidden');
            }
            
            updateCurrentPeriod();
            renderView();
        }

        // åˆ‡æ›åˆ°å‰ä¸€å€‹æœŸé–“
        function prevPeriod() {
            if (viewMode === 'month') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else {
                currentDate.setFullYear(currentDate.getFullYear() - 1);
            }
            updateCurrentPeriod();
            renderView();
        }

        // åˆ‡æ›åˆ°ä¸‹ä¸€å€‹æœŸé–“
        function nextPeriod() {
            if (viewMode === 'month') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else {
                currentDate.setFullYear(currentDate.getFullYear() + 1);
            }
            updateCurrentPeriod();
            renderView();
        }

        // æ ¹æ“šç•¶å‰è¦–åœ–æ¨¡å¼æ¸²æŸ“è¦–åœ–
        function renderView() {
            if (viewMode === 'month') {
                renderMonthView();
            } else {
                renderYearView();
            }
        }

        // åˆå§‹åŒ–æƒ…ç·’è¿½è¹¤
        function initEmotionTracker() {
            // åˆå§‹åŒ–æ¨¡æ“¬æƒ…ç·’æ•¸æ“š
            initEmotionData();
            
            // åˆå§‹åŒ–è¦–åœ–
            updateCurrentPeriod();
            renderView();
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            document.querySelectorAll('.emotion-view-btn').forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    toggleView(index === 0 ? 'month' : 'year');
                });
            });
            
            document.querySelector('.prev-period-btn').addEventListener('click', prevPeriod);
            document.querySelector('.next-period-btn').addEventListener('click', nextPeriod);
            
            // è¨­ç½®è¡¨æƒ…æŒ‰éˆ•é»æ“Šäº‹ä»¶
            document.querySelectorAll('.emoji-btn').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    const today = formatDate(new Date());
                    emotionData[today] = index + 1; // 1: é–‹å¿ƒ, 2: å¹³éœ, 3: ç„¦æ…®
                    renderView(); // é‡æ–°æ¸²æŸ“ç•¶å‰è¦–åœ–
                });
            });
        }
        
        // åˆå§‹åŒ–éŸ³é »æ’­æ”¾å™¨
        initAudioPlayer();
        
        // åˆå§‹åŒ–æƒ…ç·’è¿½è¹¤å™¨
        initEmotionTracker();
        
        // åˆå§‹åŒ–é¤å»³åŠŸèƒ½
        initRestaurantFeatures();
    </script>
</body>
</html>
